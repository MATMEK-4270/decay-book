<!DOCTYPE html>
<html lang="en"><head>
<script src="slides_alg_files/libs/clipboard/clipboard.min.js"></script>
<script src="slides_alg_files/libs/quarto-html/tabby.min.js"></script>
<script src="slides_alg_files/libs/quarto-html/popper.min.js"></script>
<script src="slides_alg_files/libs/quarto-html/tippy.umd.min.js"></script>
<link href="slides_alg_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="slides_alg_files/libs/quarto-html/light-border.css" rel="stylesheet">
<link href="slides_alg_files/libs/quarto-html/quarto-html.min.css" rel="stylesheet" data-mode="light">
<link href="slides_alg_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.3.450">

  <meta name="author" content="Mikael Mortenen">
  <title>MAT-MEK4270</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="slides_alg_files/libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="slides_alg_files/libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      { color: #003b4f; background-color: #f1f3f5; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #003b4f; } /* Normal */
    code span.al { color: #ad0000; } /* Alert */
    code span.an { color: #5e5e5e; } /* Annotation */
    code span.at { color: #657422; } /* Attribute */
    code span.bn { color: #ad0000; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #003b4f; } /* ControlFlow */
    code span.ch { color: #20794d; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #5e5e5e; } /* Comment */
    code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
    code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
    code span.dt { color: #ad0000; } /* DataType */
    code span.dv { color: #ad0000; } /* DecVal */
    code span.er { color: #ad0000; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #ad0000; } /* Float */
    code span.fu { color: #4758ab; } /* Function */
    code span.im { color: #00769e; } /* Import */
    code span.in { color: #5e5e5e; } /* Information */
    code span.kw { color: #003b4f; } /* Keyword */
    code span.op { color: #5e5e5e; } /* Operator */
    code span.ot { color: #003b4f; } /* Other */
    code span.pp { color: #ad0000; } /* Preprocessor */
    code span.sc { color: #5e5e5e; } /* SpecialChar */
    code span.ss { color: #20794d; } /* SpecialString */
    code span.st { color: #20794d; } /* String */
    code span.va { color: #111111; } /* Variable */
    code span.vs { color: #20794d; } /* VerbatimString */
    code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="slides_alg_files/libs/revealjs/dist/theme/quarto.css">
  <link href="slides_alg_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="slides_alg_files/libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="slides_alg_files/libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="slides_alg_files/libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">

  .callout {
    margin-top: 1em;
    margin-bottom: 1em;  
    border-radius: .25rem;
  }

  .callout.callout-style-simple { 
    padding: 0em 0.5em;
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
    display: flex;
  }

  .callout.callout-style-default {
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
  }

  .callout .callout-body-container {
    flex-grow: 1;
  }

  .callout.callout-style-simple .callout-body {
    font-size: 1rem;
    font-weight: 400;
  }

  .callout.callout-style-default .callout-body {
    font-size: 0.9rem;
    font-weight: 400;
  }

  .callout.callout-titled.callout-style-simple .callout-body {
    margin-top: 0.2em;
  }

  .callout:not(.callout-titled) .callout-body {
      display: flex;
  }

  .callout:not(.no-icon).callout-titled.callout-style-simple .callout-content {
    padding-left: 1.6em;
  }

  .callout.callout-titled .callout-header {
    padding-top: 0.2em;
    margin-bottom: -0.2em;
  }

  .callout.callout-titled .callout-title  p {
    margin-top: 0.5em;
    margin-bottom: 0.5em;
  }
    
  .callout.callout-titled.callout-style-simple .callout-content  p {
    margin-top: 0;
  }

  .callout.callout-titled.callout-style-default .callout-content  p {
    margin-top: 0.7em;
  }

  .callout.callout-style-simple div.callout-title {
    border-bottom: none;
    font-size: .9rem;
    font-weight: 600;
    opacity: 75%;
  }

  .callout.callout-style-default  div.callout-title {
    border-bottom: none;
    font-weight: 600;
    opacity: 85%;
    font-size: 0.9rem;
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-default div.callout-content {
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-simple .callout-icon::before {
    height: 1rem;
    width: 1rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 1rem 1rem;
  }

  .callout.callout-style-default .callout-icon::before {
    height: 0.9rem;
    width: 0.9rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 0.9rem 0.9rem;
  }

  .callout-title {
    display: flex
  }
    
  .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  .callout.no-icon::before {
    display: none !important;
  }

  .callout.callout-titled .callout-body > .callout-content > :last-child {
    margin-bottom: 0.5rem;
  }

  .callout.callout-titled .callout-icon::before {
    margin-top: .5rem;
    padding-right: .5rem;
  }

  .callout:not(.callout-titled) .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  /* Callout Types */

  div.callout-note {
    border-left-color: #4582ec !important;
  }

  div.callout-note .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEU0lEQVRYCcVXTWhcVRQ+586kSUMMxkyaElstCto2SIhitS5Ek8xUKV2poatCcVHtUlFQk8mbaaziwpWgglJwVaquitBOfhQXFlqlzSJpFSpIYyXNjBNiTCck7x2/8/LeNDOZxDuEkgOXe++553zfefee+/OYLOXFk3+1LLrRdiO81yNqZ6K9cG0P3MeFaMIQjXssE8Z1JzLO9ls20MBZX7oG8w9GxB0goaPrW5aNMp1yOZIa7Wv6o2ykpLtmAPs/vrG14Z+6d4jpbSKuhdcSyq9wGMPXjonwmESXrriLzFGOdDBLB8Y6MNYBu0dRokSygMA/mrun8MGFN3behm6VVAwg4WR3i6FvYK1T7MHo9BK7ydH+1uurECoouk5MPRyVSBrBHMYwVobG2aOXM07sWrn5qgB60rc6mcwIDJtQrnrEr44kmy+UO9r0u9O5/YbkS9juQckLed3DyW2XV/qWBBB3ptvI8EUY3I9p/67OW+g967TNr3Sotn3IuVlfMLVnsBwH4fsnebJvyGm5GeIUA3jljERmrv49SizPYuq+z7c2H/jlGC+Ghhupn/hcapqmcudB9jwJ/3jvnvu6vu5lVzF1fXyZuZZ7U8nRmVzytvT+H3kilYvH09mLWrQdwFSsFEsxFVs5fK7A0g8gMZjbif4ACpKbjv7gNGaD8bUrlk8x+KRflttr22JEMRUbTUwwDQScyzPgedQHZT0xnx7ujw2jfVfExwYHwOsDTjLdJ2ebmeQIlJ7neo41s/DrsL3kl+W2lWvAga0tR3zueGr6GL78M3ifH0rGXrBC2aAR8uYcIA5gwV8zIE8onoh8u0Fca/ciF7j1uOzEnqcIm59sEXoGc0+z6+H45V1CvAvHcD7THztu669cnp+L0okAeIc6zjbM/24LgGM1gZk7jnRu1aQWoU9sfUOuhrmtaPIO3YY1KLLWZaEO5TKUbMY5zx8W9UJ6elpLwKXbsaZ4EFl7B4bMtDv0iRipKoDQT2sNQI9b1utXFdYisi+wzZ/ri/1m7QfDgEuvgUUEIJPq3DhX/5DWNqIXDOweC2wvIR90Oq3lDpdMIgD2r0dXvGdsEW5H6x6HLRJYU7C69VefO1x8Gde1ZFSJLfWS1jbCnhtOPxmpfv2LXOA2Xk2tvnwKKPFuZ/oRmwBwqRQDcKNeVQkYcOjtWVBuM/JuYw5b6isojIkYxyYAFn5K7ZBF10fea52y8QltAg6jnMqNHFBmGkQ1j+U43HMi2xMar1Nv0zGsf1s8nUsmUtPOOrbFIR8bHFDMB5zL13Gmr/kGlCkUzedTzzmzsaJXhYawnA3UmARpiYj5ooJZiUoxFRtK3X6pgNPv+IZVPcnwbOl6f+aBaO1CNvPW9n9LmCp01nuSaTRF2YxHqZ8DYQT6WsXT+RD6eUztwYLZ8rM+rcPxamv1VQzFUkzFXvkiVrySGQgJNvXHJAxiU3/NwiC03rSf05VBaPtu/Z7/B8Yn/w7eguloAAAAAElFTkSuQmCC');
  }

  div.callout-note.callout-style-default .callout-title {
    background-color: #dae6fb
  }

  div.callout-important {
    border-left-color: #d9534f !important;
  }

  div.callout-important .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEKklEQVRYCcVXTWhcVRS+575MJym48A+hSRFr00ySRQhURRfd2HYjk2SSTokuBCkU2o0LoSKKraKIBTcuFCoidGFD08nkBzdREbpQ1EDNIv8qSGMFUboImMSZd4/f9zJv8ibJMC8xJQfO3HPPPef7zrvvvnvviIkpC9nsw0UttFunbUhpFzFtarSd6WJkStVMw5xyVqYTvkwfzuf/5FgtkVoB0729j1rjXwThS7Vio+Mo6DNnvLfahoZ+i/o32lULuJ3NNiz7q6+pyAUkJaFF6JwaM2lUJlV0MlnQn5aTRbEu0SEqHUa0A4AdiGuB1kFXRfVyg5d87+Dg4DL6m2TLAub60ilj7A1Ec4odSAc8X95sHh7+ZRPCFo6Fnp7HfU/fBng/hi10CjCnWnJjsxvDNxWw0NfV6Rv5GgP3I3jGWXumdTD/3cbEOP2ZbOZp69yniG3FQ9z1jD7bnBu9Fc2tKGC2q+uAJOQHBDRiZX1x36o7fWBs7J9ownbtO+n0/qWkvW7UPIfc37WgT6ZGR++EOJyeQDSb9UB+DZ1G6DdLDzyS+b/kBCYGsYgJbSQHuThGKRcw5xdeQf8YdNHsc6ePXrlSYMBuSIAFTGAtQo+VuALo4BX83N190NWZWbynBjhOHsmNfFWLeL6v+ynsA58zDvvAC8j5PkbOcXCMg2PZFk3q8MjI7WAG/Dp9AwP7jdGBOOQkAvlFUB+irtm16I1Zw9YBcpGTGXYmk3kQIC/Cds55l+iMI3jqhjAuaoe+am2Jw5GT3Nbz3CkE12NavmzN5+erJW7046n/CH1RO/RVa8lBLozXk9uqykkGAyRXLWlLv5jyp4RFsG5vGVzpDLnIjTWgnRy2Rr+tDKvRc7Y8AyZq10jj8DqXdnIRNtFZb+t/ZRtXcDiVnzpqx8mPcDWxgARUqx0W1QB9MeUZiNrV4qP+Ehc+BpNgATsTX8ozYKL2NtFYAHc84fG7ndxUPr+AR/iQSns7uSUufAymwDOb2+NjK27lEFocm/EE2WpyIy/Hi66MWuMKJn8RvxIcj87IM5Vh9663ziW36kR0HNenXuxmfaD8JC7tfKbrhFr7LiZCrMjrzTeGx+PmkosrkNzW94ObzwocJ7A1HokLolY+AvkTiD/q1H0cN48c5EL8Crkttsa/AXQVDmutfyku0E7jShx49XqV3MFK8IryDhYVbj7Sj2P2eBxwcXoe8T8idsKKPRcnZw1b+slFTubwUwhktrfnAt7J++jwQtLZcm3sr9LQrjRzz6cfMv9aLvgmnAGvpoaGLxM4mAEaLV7iAzQ3oU0IvD5x9ix3yF2RAAuYAOO2f7PEFWCXZ4C9Pb2UsgDeVnFSpbFK7/IWu7TPTvBqzbGdCHOJQSxiEjt6IyZmxQyEJHv6xyQsYk//moVFsN2zP6fRImjfq7/n/wFDguUQFNEwugAAAABJRU5ErkJggg==');
  }

  div.callout-important.callout-style-default .callout-title {
    background-color: #f7dddc
  }

  div.callout-warning {
    border-left-color: #f0ad4e !important;
  }

  div.callout-warning .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAETklEQVRYCeVWW2gcVRg+58yaTUnizqbipZeX4uWhBEniBaoUX1Ioze52t7sRq6APio9V9MEaoWlVsFasRq0gltaAPuxms8lu0gcviE/FFOstVbSIxgcv6SU7EZqmdc7v9+9mJtNks51NTUH84ed889/PP+cmxP+d5FIbMJmNbpREu4WUkiTtCicKny0l1pIKmBzovF2S+hIJHX8iEu3hZJ5lNZGqyRrGSIQpq15AzF28jgpeY6yk6GVdrfFqdrD6Iw+QlB8g0YS2g7dyQmXM/IDhBhT0UCiRf59lfqmmDvzRt6kByV/m4JjtzuaujMUM2c5Z2d6JdKrRb3K2q6mA+oYVz8JnDdKPmmNthzkAk/lN63sYPgevrguc72aZX/L9C6x09GYyxBgCX4NlvyGUHOKELlm5rXeR1kchuChJt4SSwyddZRXgvwMGvYo4QSlk3/zkHD8UHxwVJA6zjZZqP8v8kK8OWLnIZtLyCAJagYC4rTGW/9Pqj92N/c+LUaAj27movwbi19tk/whRCIE7Q9vyI6yvRpftAKVTdUjOW40X3h5OXsKCdmFcx0xlLJoSuQngnrJe7Kcjm4OMq9FlC7CMmScQANuNvjfP3PjGXDBaUQmbp296S5L4DrpbrHN1T87ZVEZVCzg1FF0Ft+dKrlLukI+/c9ENo+TvlTDbYFvuKPtQ9+l052rXrgKoWkDAFnvh0wTOmYn8R5f4k/jN/fZiCM1tQx9jQQ4ANhqG4hiL0qIFTGViG9DKB7GYzgubnpofgYRwO+DFjh0Zin2m4b/97EDkXkc+f6xYAPX0KK2I/7fUQuwzuwo/L3AkcjugPNixC8cHf0FyPjWlItmLxWw4Ou9YsQCr5fijMGoD/zpdRy95HRysyXA74MWOnscpO4j2y3HAVisw85hX5+AFBRSHt4ShfLFkIMXTqyKFc46xdzQM6XbAi702a7sy04J0+feReMFKp5q9esYLCqAZYw/k14E/xcLLsFElaornTuJB0svMuJINy8xkIYuL+xPAlWRceH6+HX7THJ0djLUom46zREu7tTkxwmf/FdOZ/sh6Q8qvEAiHpm4PJ4a/doJe0gH1t+aHRgCzOvBvJedEK5OFE5jpm4AGP2a8Dxe3gGJ/pAutug9Gp6he92CsSsWBaEcxGx0FHytmIpuqGkOpldqNYQK8cSoXvd+xLxXADw0kf6UkJNFtdo5MOgaLjiQOQHcn+A6h5NuL2s0qsC2LOM75PcF3yr5STuBSAcGG+meA14K/CI21HcS4LBT6tv0QAh8Dr5l93AhZzG5ZJ4VxAqdZUEl9z7WJ4aN+svMvwHHL21UKTd1mqvChH7/Za5xzXBBKrUcB0TQ+Ulgkfbi/H/YT5EptrGzsEK7tR1B7ln9BBwckYfMiuSqklSznIuoIIOM42MQO+QnduCoFCI0bpkzjCjddHPN/F+2Yu+sd9bKNpVwHhbS3LluK/0zgfwD0xYI5dXuzlQAAAABJRU5ErkJggg==');
  }

  div.callout-warning.callout-style-default .callout-title {
    background-color: #fcefdc
  }

  div.callout-tip {
    border-left-color: #02b875 !important;
  }

  div.callout-tip .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAADr0lEQVRYCe1XTWgTQRj9ZjZV8a9SPIkKgj8I1bMHsUWrqYLVg4Ue6v9BwZOxSYsIerFao7UiUryIqJcqgtpimhbBXoSCVxUFe9CTiogUrUp2Pt+3aUI2u5vdNh4dmMzOzHvvezuz8xNFM0mjnbXaNu1MvFWRXkXEyE6aYOYJpdW4IXuA4r0fo8qqSMDBU0v1HJUgVieAXxzCsdE/YJTdFcVIZQNMyhruOMJKXYFoLfIfIvVIMWdsrd+Rpd86ZmyzzjJmLStqRn0v8lzkb4rVIXvnpScOJuAn2ACC65FkPzEdEy4TPWRLJ2h7z4cArXzzaOdKlbOvKKX25Wl00jSnrwVxAg3o4dRxhO13RBSdNvH0xSARv3adTXbBdTf64IWO2vH0LT+cv4GR1DJt+DUItaQogeBX/chhbTBxEiZ6gftlDNXTrvT7co4ub5A6gp9HIcHvzTa46OS5fBeP87Qm0fQkr4FsYgVQ7Qg+ZayaDg9jhg1GkWj8RG6lkeSacrrHgDaxdoBiZPg+NXV/KifMuB6//JmYH4CntVEHy/keA6x4h4CU5oFy8GzrBS18cLJMXcljAKB6INjWsRcuZBWVaS3GDrqB7rdapVIeA+isQ57Eev9eCqzqOa81CY05VLd6SamW2wA2H3SiTbnbSxmzfp7WtKZkqy4mdyAlGx7ennghYf8voqp9cLSgKdqNfa6RdRsAAkPwRuJZNbpByn+RrJi1RXTwdi8RQF6ymDwGMAtZ6TVE+4uoKh+MYkcLsT0Hk8eAienbiGdjJHZTpmNjlbFJNKDVAp2fJlYju6IreQxQ08UJDNYdoLSl6AadO+fFuCQqVMB1NJwPm69T04Wv5WhfcWyfXQB+wXRs1pt+nCknRa0LVzSA/2B+a9+zQJadb7IyyV24YAxKp2Jqs3emZTuNnKxsah+uabKbMk7CbTgJx/zIgQYErIeTKRQ9yD9wxVof5YolPHqaWo7TD6tJlh7jQnK5z2n3+fGdggIOx2kaa2YI9QWarc5Ce1ipNWMKeSG4DysFF52KBmTNMmn5HqCFkwy34rDg05gDwgH3bBi+sgFhN/e8QvRn8kbamCOhgrZ9GJhFDgfcMHzFb6BAtjKpFhzTjwv1KCVuxHvCbsSiEz4CANnj84cwHdFXAbAOJ4LTSAawGWFn5tDhLMYz6nWeU2wJfIhmIJBefcd/A5FWQWGgrWzyORZ3Q6HuV+Jf0Bj+BTX69fm1zWgK7By1YTXchFDORywnfQ7GpzOo6S+qECrsx2ifVQAAAABJRU5ErkJggg==');
  }

  div.callout-tip.callout-style-default .callout-title {
    background-color: #ccf1e3
  }

  div.callout-caution {
    border-left-color: #fd7e14 !important;
  }

  div.callout-caution .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAACV0lEQVRYCdVWzWoUQRCuqp2ICBLJXgITZL1EfQDBW/bkzUMUD7klD+ATSHBEfAIfQO+iXsWDxJsHL96EHAwhgzlkg8nBg25XWb0zIb0zs9muYYWkoKeru+vn664fBqElyZNuyh167NXJ8Ut8McjbmEraKHkd7uAnAFku+VWdb3reSmRV8PKSLfZ0Gjn3a6Xlcq9YGb6tADjn+lUfTXtVmaZ1KwBIvFI11rRXlWlatwIAAv2asaa9mlB9wwygiDX26qaw1yYPzFXg2N1GgG0FMF8Oj+VIx7E/03lHx8UhvYyNZLN7BwSPgekXXLribw7w5/c8EF+DBK5idvDVYtEEwMeYefjjLAdEyQ3M9nfOkgnPTEkYU+sxMq0BxNR6jExrAI31H1rzvLEfRIdgcv1XEdj6QTQAS2wtstEALLG1yEZ3QhH6oDX7ExBSFEkFINXH98NTrme5IOaaA7kIfiu2L8A3qhH9zRbukdCqdsA98TdElyeMe5BI8Rs2xHRIsoTSSVFfCFCWGPn9XHb4cdobRIWABNf0add9jakDjQJpJ1bTXOJXnnRXHRf+dNL1ZV1MBRCXhMbaHqGI1JkKIL7+i8uffuP6wVQAzO7+qVEbF6NbS0LJureYcWXUUhH66nLR5rYmva+2tjRFtojkM2aD76HEGAD3tPtKM309FJg5j/K682ywcWJ3PASCcycH/22u+Bh7Aa0ehM2Fu4z0SAE81HF9RkB21c5bEn4Dzw+/qNOyXr3DCTQDMBOdhi4nAgiFDGCinIa2owCEChUwD8qzd03PG+qdW/4fDzjUMcE1ZpIAAAAASUVORK5CYII=');
  }

  div.callout-caution.callout-style-default .callout-title {
    background-color: #ffe5d0
  }

  </style>
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="quarto-title-block center">
  <h1 class="title">MAT-MEK4270</h1>
  <p class="subtitle">Study guide: Finite difference algorithms and implementations for exponential decay models</p>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
Mikael Mortenen 
</div>
</div>
</div>

</section>
<section>

<section id="mat-mek4270-in-a-nutshell-1" class="slide level2">
<h2>MAT-MEK4270 in a nutshell</h2>
<div id="42700:about">

</div>
<ul>
<li><p>Numerical methods for partial differential equations (PDEs)</p></li>
<li><p>How do we solve a PDE in practice and produce numbers?</p></li>
<li><p>How do we trust the answer?</p></li>
<li><p>Approach: <em>simplify, understand, generalize</em></p></li>
</ul>
<div class="callout callout-tip callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>After the course</strong></p>
</div>
<div class="callout-content">
<p>You see a PDE and can’t wait to program a method and visualize a solution! Somebody asks if the solution is right and you can give a convincing answer.</p>
</div>
</div>
</div>
</section>
<section id="the-new-official-six-point-course-description" class="slide level2 smaller">
<h2>The new official six-point course description</h2>
<p>After having completed MAT-MEK4270 you</p>
<ul>
<li><p>can derive methods and implement them to solve frequently arising partial differential equations (PDEs) from physics and mechanics.</p></li>
<li><p>have a good understanding of finite difference and finite element methods and how they are applied in linear and nonlinear PDE problems.</p></li>
<li><p>can identify numerical artifacts and perform mathematical analysis to understand and cure non-physical effects.</p></li>
<li><p>can apply sophisticated programming techniques in Python, combined with Cython, C, C++, and Fortran code, to create modern, flexible simulation programs.</p></li>
<li><p>can construct verification tests and automate them.</p></li>
<li><p>have experience with project hosting sites (GitHub), version control systems (Git), report writing (LaTeX), and Python scripting for performing reproducible computational science.</p></li>
</ul>
</section>
<section id="more-specific-contents-finite-difference-methods" class="slide level2">
<h2>More specific contents: finite difference methods</h2>
<ul>
<li><p>ODEs</p></li>
<li><p>the wave equation <span class="math inline">\(u_{tt}=u_{xx}\)</span> in 1D, 2D, 3D</p></li>
<li><p>the diffusion equation <span class="math inline">\(u_t=u_{xx}\)</span> in 1D, 2D, 3D</p></li>
<li><p>write your own software from scratch</p></li>
<li><p>understand how the methods work and why they fail</p></li>
</ul>
</section>
<section id="more-specific-contents-finite-element-methods" class="slide level2">
<h2>More specific contents: finite element methods</h2>
<ul>
<li><p>stationary diffusion equations <span class="math inline">\(u_{xx}=f\)</span> in 1D</p></li>
<li><p>time-dependent diffusion and wave equations in 1D</p></li>
<li><p>PDEs in 2D and 3D by use of the FEniCS software</p></li>
<li><p>perform hand-calculations, write your own software (1D)</p></li>
<li><p>understand how the methods work and why they fail</p></li>
</ul>
</section>
<section id="more-specific-contents-nonlinear-and-advanced-problems" class="slide level2">
<h2>More specific contents: nonlinear and advanced problems</h2>
<ul>
<li><p>Nonlinear PDEs</p>
<ul>
<li>Newton and Picard iteration methods, finite differences and elements</li>
</ul></li>
<li><p>More advanced PDEs for fluid flow and elasticity</p></li>
<li><p>Parallel computing</p></li>
</ul>
</section>
<section id="philosophy-simplify-understand-generalize" class="slide level2">
<h2>Philosophy: simplify, understand, generalize</h2>
<ul>
<li><p>Start with simplified ODE/PDE problems</p></li>
<li><p>Learn to reason about the discretization</p></li>
<li><p>Learn to implement, verify, and experiment</p></li>
<li><p>Understand the method, program, and results</p></li>
<li><p>Generalize the problem, method, and program</p></li>
</ul>
<p>This is the power of applied mathematics!</p>
</section>
<section id="required-software" class="slide level2">
<h2>Required software</h2>
<ul>
<li><p>Our software platform: Python (sometimes combined with Cython, Fortran, C, C++)</p></li>
<li><p>Important Python packages: <code>numpy</code>, <code>scipy</code>, <code>matplotlib</code>, <code>sympy</code>, <code>fenics</code>, <code>scitools</code>, …</p></li>
<li><p>Suggested installation: Run <a href="http://hplgit.github.io/edu/accesspy/._accesspy_uio005.html">Ubuntu in a virtual machine</a></p></li>
<li><p>Alternative: run a <a href="http://hplgit.github.io/edu/accesspy/._accesspy_uio007.html">Vagrant machine</a></p></li>
</ul>
</section>
<section id="assumedideal-background" class="slide level2">
<h2>Assumed/ideal background</h2>
<ul>
<li><p>INF1100: Python programming, solution of ODEs</p></li>
<li><p>Some experience with finite difference methods</p></li>
<li><p>Some analytical and numerical knowledge of PDEs</p></li>
<li><p>Much experience with calculus and linear algebra</p></li>
<li><p>Much experience with programming of mathematical problems</p></li>
<li><p>Experience with mathematical modeling with PDEs (from physics, mechanics, geophysics, or …)</p></li>
</ul>
</section>
<section id="start-up-example-for-the-course" class="slide level2">
<h2>Start-up example for the course</h2>
<p>What if you don’t have this ideal background?</p>
<ul>
<li><p>Students come to this course with very different backgrounds</p></li>
<li><p>First task: summarize assumed background knowledge by going through a simple example</p></li>
<li><p>Also in this example:</p>
<ul>
<li><p>Some fundamental material on software implementation and software testing</p></li>
<li><p>Material on analyzing numerical methods to understand why they can fail</p></li>
<li><p>Applications to real-world problems</p></li>
</ul></li>
</ul>
</section>
<section id="start-up-example" class="slide level2">
<h2>Start-up example</h2>
<p><strong>ODE problem.</strong></p>
<p><span class="math display">\[
u'=-au,\quad u(0)=I,\ t\in (0,T],
\]</span></p>
<p>where <span class="math inline">\(a&gt;0\)</span> is a constant.</p>
<p>Everything we do is motivated by what we need as building blocks for solving PDEs!</p>
</section>
<section id="what-to-learn-in-the-start-up-example-standard-topics" class="slide level2">
<h2>What to learn in the start-up example; standard topics</h2>
<ul>
<li><p>How to think when constructing finite difference methods, with special focus on the Forward Euler, Backward Euler, and Crank-Nicolson (midpoint) schemes</p></li>
<li><p>How to formulate a computational algorithm and translate it into Python code</p></li>
<li><p>How to make curve plots of the solutions</p></li>
<li><p>How to compute numerical errors</p></li>
<li><p>How to compute convergence rates</p></li>
</ul>
</section>
<section id="what-to-learn-in-the-start-up-example-programming-topics" class="slide level2">
<h2>What to learn in the start-up example; programming topics</h2>
<ul>
<li><p>How to verify an implementation and automate verification through nose tests in Python</p></li>
<li><p>How to structure code in terms of functions, classes, and modules</p></li>
<li><p>How to work with Python concepts such as arrays, lists, dictionaries, lambda functions, functions in functions (closures), doctests, unit tests, command-line interfaces, graphical user interfaces</p></li>
<li><p>How to perform array computing and understand the difference from scalar computing</p></li>
<li><p>How to conduct and automate large-scale numerical experiments</p></li>
<li><p>How to generate scientific reports</p></li>
</ul>
</section>
<section id="what-to-learn-in-the-start-up-example-mathematical-analysis" class="slide level2">
<h2>What to learn in the start-up example; mathematical analysis</h2>
<ul>
<li><p>How to uncover numerical artifacts in the computed solution</p></li>
<li><p>How to analyze the numerical schemes mathematically to understand why artifacts occur</p></li>
<li><p>How to derive mathematical expressions for various measures of the error in numerical methods, frequently by using the <code>sympy</code> software for symbolic computation</p></li>
<li><p>Introduce concepts such as finite difference operators, mesh (grid), mesh functions, stability, truncation error, consistency, and convergence</p></li>
</ul>
</section>
<section id="what-to-learn-in-the-start-up-example-generalizations" class="slide level2">
<h2>What to learn in the start-up example; generalizations</h2>
<ul>
<li><p>Generalize the example to <span class="math inline">\(u'(t)=-a(t)u(t) + b(t)\)</span></p></li>
<li><p>Present additional methods for the general nonlinear ODE <span class="math inline">\(u'=f(u,t)\)</span>, which is either a scalar ODE or a system of ODEs</p></li>
<li><p>How to access professional packages for solving ODEs</p></li>
<li><p>How our model equations like <span class="math inline">\(u'=-au\)</span> arises in a wide range of phenomena in physics, biology, and finance</p></li>
</ul>
</section></section>
<section>
<section id="finite-difference-methods" class="title-slide slide level1 center">
<h1>Finite difference methods</h1>
<div id="decay:fdm">

</div>
<ul>
<li><p>The finite difference method is the simplest method for solving differential equations</p></li>
<li><p>Fast to learn, derive, and implement</p></li>
<li><p>A very useful tool to know, even if you aim at using the finite element or the finite volume method</p></li>
</ul>
<!-- dom:FIGURE: [fig-alg/fdm_u_uei.png, width=400 frac=0.7] -->
<!-- begin figure -->

<img src="fig-alg/fdm_u_uei.png" width="400" class="r-stretch"><p style="font-size: 0.9em">
</p><p><i>Figure 1</i></p>
<p></p>
<!-- end figure -->
</section>
<section id="topics-in-the-first-intro-to-the-finite-difference-method" class="slide level2">
<h2>Topics in the first intro to the finite difference method</h2>
<p><strong>Contents.</strong></p>
<ul>
<li><p>How to think about finite difference discretization</p></li>
<li><p>Key concepts:</p>
<ul>
<li><p>mesh</p></li>
<li><p>mesh function</p></li>
<li><p>finite difference approximations</p></li>
</ul></li>
<li><p>The Forward Euler, Backward Euler, and Crank-Nicolson methods</p></li>
<li><p>Finite difference operator notation</p></li>
<li><p>How to derive an algorithm and implement it in Python</p></li>
<li><p>How to test the implementation</p></li>
</ul>
</section>
<section id="a-basic-model-for-exponential-decay" class="slide level2">
<h2>A basic model for exponential decay</h2>
<div id="decay:model">

</div>
<p>The world’s simplest (?) ODE:</p>
<p><span class="math display">\[
u'(t) = -au(t),\quad u(0)=I,\ t\in (0,T]
\]</span></p>
<p><strong>Observation.</strong></p>
<p>We can learn a lot about numerical methods, computer implementation, program testing, and real applications of these tools by using this very simple ODE as example. The teaching principle is to keep the math as simple as possible while learning computer tools.</p>
<!-- dom:FIGURE: [fig-alg/FE1.png, width=600 frac=0.7] -->
<!-- begin figure -->

<img src="fig-alg/FE1.png" width="600" class="r-stretch"><p style="font-size: 0.9em">
</p><p><i>Figure 1</i></p>
<p></p>
<!-- end figure -->
</section>
<section id="the-ode-model-has-a-range-of-applications-in-many-fields" class="slide level2">
<h2>The ODE model has a range of applications in many fields</h2>
<ul>
<li><p>Growth and decay of populations (cells, animals, human)</p></li>
<li><p>Growth and decay of a fortune</p></li>
<li><p>Radioactive decay</p></li>
<li><p>Cooling/heating of an object</p></li>
<li><p>Pressure variation in the atmosphere</p></li>
<li><p>Vertical motion of a body in water/air</p></li>
<li><p>Time-discretization of diffusion PDEs by Fourier techniques</p></li>
</ul>
<p>See the <a href="http://tinyurl.com/nclmcng/pub/sphinx-decay/._main_decay008.html">text</a> for details.</p>
</section>
<section id="the-ode-problem-has-a-continuous-and-discrete-version" class="slide level2">
<h2>The ODE problem has a continuous and discrete version</h2>
<h3 id="continuous-problem">Continuous problem</h3>
<!-- Equation labels as ordinary links -->
<div id="decay:problem">

</div>
<p><span class="math display">\[
\begin{equation}
u' = -au,\ t\in (0,T], \quad u(0)=I
\label{decay:problem} \tag{1}
\end{equation}
\]</span></p>
<p>(varies with a continuous <span class="math inline">\(t\)</span>)</p>
<h3 id="discrete-problem">Discrete problem</h3>
<p>Numerical methods applied to the continuous problem turns it into a discrete problem</p>
<!-- Equation labels as ordinary links -->
<div id="decay:problem:discrete">

</div>
<p><span class="math display">\[
\begin{equation}
u^{n+1} = \mbox{const} \cdot u^n, \quad n=0,1,\ldots N_t-1, \quad u^n=I
\label{decay:problem:discrete} \tag{2}
\end{equation}
\]</span></p>
<p>(varies with discrete mesh points <span class="math inline">\(t_n\)</span>)</p>
</section>
<section id="the-steps-in-the-finite-difference-method" class="slide level2">
<h2>The steps in the finite difference method</h2>
<div id="decay:schemes:keysteps">

</div>
<p>Solving a differential equation by a finite difference method consists of four steps:</p>
<ol type="1">
<li><p>discretizing the domain,</p></li>
<li><p>fulfilling the equation at discrete time points,</p></li>
<li><p>replacing derivatives by finite differences,</p></li>
<li><p>formulating a recursive algorithm.</p></li>
</ol>
</section>
<section id="step-1-discretizing-the-domain" class="slide level2">
<h2>Step 1: Discretizing the domain</h2>
<p>The time domain <span class="math inline">\([0,T]\)</span> is represented by a <em>mesh</em>: a finite number of <span class="math inline">\(N_t+1\)</span> points</p>
<p><span class="math display">\[
0 = t_0 &lt; t_1 &lt; t_2 &lt; \cdots &lt; t_{N_t-1} &lt; t_{N_t} = T
\]</span></p>
<ul>
<li><p>We seek the solution <span class="math inline">\(u\)</span> at the mesh points: <span class="math inline">\(u(t_n)\)</span>, <span class="math inline">\(n=1,2,\ldots,N_t\)</span>.</p></li>
<li><p>Note: <span class="math inline">\(u^0\)</span> is known as <span class="math inline">\(I\)</span>.</p></li>
<li><p>Notational short-form for the numerical approximation to <span class="math inline">\(u(t_n)\)</span>: <span class="math inline">\(u^n\)</span></p></li>
<li><p>In the differential equation: <span class="math inline">\(u\)</span> is the exact solution</p></li>
<li><p>In the numerical method and implementation: <span class="math inline">\(u^n\)</span> is the numerical approximation, <span class="math inline">\(u_{\mbox{\footnotesize e}}(t)\)</span> is the exact solution</p></li>
</ul>
</section>
<section id="step-1-discretizing-the-domain-1" class="slide level2">
<h2>Step 1: Discretizing the domain</h2>
<p><span class="math inline">\(u^n\)</span> is a mesh function, defined at the mesh points <span class="math inline">\(t_n\)</span>, <span class="math inline">\(n=0,\ldots,N_t\)</span> only.</p>
<!-- dom:FIGURE: [fig-alg/fdm_u_ue.png, width=600 frac=0.7] -->
<!-- begin figure -->

<img src="fig-alg/fdm_u_ue.png" width="600" class="r-stretch"><p style="font-size: 0.9em">
</p><p><i>Figure 1</i></p>
<p></p>
<!-- end figure -->
</section>
<section id="what-about-a-mesh-function-between-the-mesh-points" class="slide level2">
<h2>What about a mesh function between the mesh points?</h2>
<p>Can extend the mesh function to yield values between mesh points by <em>linear interpolation</em>:</p>
<!-- Equation labels as ordinary links -->
<div id="_auto1">

</div>
<p><span class="math display">\[
\begin{equation}
u(t) \approx u^n + \frac{u^{n+1}-u^n}{t_{n+1}-t_n}(t - t_n)
\label{_auto1} \tag{3}
\end{equation}
\]</span></p>
<!-- dom:FIGURE: [fig-alg/fdm_u_uei.png, width=500 frac=0.7] -->
<!-- begin figure -->

<img src="fig-alg/fdm_u_uei.png" width="500" class="r-stretch"><p style="font-size: 0.9em">
</p><p><i>Figure 1</i></p>
<p></p>
<!-- end figure -->
</section>
<section id="step-2-fulfilling-the-equation-at-discrete-time-points" class="slide level2">
<h2>Step 2: Fulfilling the equation at discrete time points</h2>
<ul>
<li><p>The ODE holds for all <span class="math inline">\(t\in (0,T]\)</span> (infinite no of points)</p></li>
<li><p>Idea: let the ODE be valid at the mesh points only (finite no of points)</p></li>
</ul>
<!-- Equation labels as ordinary links -->
<div id="decay:step2">

</div>
<p><span class="math display">\[
\begin{equation}
u'(t_n) = -au(t_n),\quad n=1,\ldots,N_t
\label{decay:step2} \tag{4}
\end{equation}
\]</span></p>
</section>
<section id="step-3-replacing-derivatives-by-finite-differences" class="slide level2">
<h2>Step 3: Replacing derivatives by finite differences</h2>
<p>Now it is time for the <em>finite difference</em> approximations of derivatives:</p>
<!-- Equation labels as ordinary links -->
<div id="decay:FEdiff">

</div>
<p><span class="math display">\[
\begin{equation}
u'(t_n) \approx \frac{u^{n+1}-u^{n}}{t_{n+1}-t_n}
\label{decay:FEdiff} \tag{5}
\end{equation}
\]</span></p>
<!-- dom:FIGURE: [fig-alg/fd_forward.png, width=400 frac=0.8] -->
<!-- begin figure -->

<img src="fig-alg/fd_forward.png" width="400" class="r-stretch"><p style="font-size: 0.9em">
</p><p><i>Figure 1</i></p>
<p></p>
<!-- end figure -->
</section>
<section id="step-3-replacing-derivatives-by-finite-differences-1" class="slide level2">
<h2>Step 3: Replacing derivatives by finite differences</h2>
<p>Inserting the finite difference approximation in</p>
<p><span class="math display">\[
u'(t_n) = -au(t_n)
\]</span></p>
<p>gives</p>
<!-- Equation labels as ordinary links -->
<div id="decay:step3">

</div>
<p><span class="math display">\[
\begin{equation}
\frac{u^{n+1}-u^{n}}{t_{n+1}-t_n} = -au^{n},\quad n=0,1,\ldots,N_t-1
\label{decay:step3} \tag{6}
\end{equation}
\]</span></p>
<p>(Known as <em>discrete equation</em>, or <em>discrete problem</em>, or <em>finite difference method/scheme</em>)</p>
</section>
<section id="step-4-formulating-a-recursive-algorithm" class="slide level2">
<h2>Step 4: Formulating a recursive algorithm</h2>
<p>How can we actually compute the <span class="math inline">\(u^n\)</span> values?</p>
<ul>
<li><p>given <span class="math inline">\(u^0=I\)</span></p></li>
<li><p>compute <span class="math inline">\(u^1\)</span> from <span class="math inline">\(u^0\)</span></p></li>
<li><p>compute <span class="math inline">\(u^2\)</span> from <span class="math inline">\(u^1\)</span></p></li>
<li><p>compute <span class="math inline">\(u^3\)</span> from <span class="math inline">\(u^2\)</span> (and so forth)</p></li>
</ul>
<p>In general: we have <span class="math inline">\(u^n\)</span> and seek <span class="math inline">\(u^{n+1}\)</span></p>
<p><strong>The Forward Euler scheme.</strong></p>
<p>Solve wrt <span class="math inline">\(u^{n+1}\)</span> to get the computational formula:</p>
<!-- Equation labels as ordinary links -->
<div id="decay:FE">

</div>
<p><span class="math display">\[
\begin{equation}
u^{n+1} = u^n - a(t_{n+1} -t_n)u^n
\label{decay:FE} \tag{7}
\end{equation}
\]</span></p>
</section>
<section id="let-us-apply-the-scheme-by-hand" class="slide level2">
<h2>Let us apply the scheme by hand</h2>
<p>Assume constant time spacing: <span class="math inline">\(\Delta t = t_{n+1}-t_n=\mbox{const}\)</span></p>
<p><span class="math display">\[
\begin{align*}
u_0 &amp;= I,\\
u_1 &amp; = u^0 - a\Delta t u^0 = I(1-a\Delta t),\\
u_2 &amp; = I(1-a\Delta t)^2,\\
u^3 &amp;= I(1-a\Delta t)^3,\\
&amp;\vdots\\
u^{N_t} &amp;= I(1-a\Delta t)^{N_t}
\end{align*}
\]</span></p>
<p>Ooops - we can find the numerical solution by hand (in this simple example)! No need for a computer (yet)…</p>
</section>
<section id="a-backward-difference" class="slide level2">
<h2>A backward difference</h2>
<p>Here is another finite difference approximation to the derivative (backward difference):</p>
<!-- Equation labels as ordinary links -->
<div id="decay:BEdiff">

</div>
<p><span class="math display">\[
\begin{equation}
u'(t_n) \approx \frac{u^{n}-u^{n-1}}{t_{n}-t_{n-1}}
\label{decay:BEdiff} \tag{8}
\end{equation}
\]</span></p>
<!-- dom:FIGURE: [fig-alg/fd_backward.png, width=400 frac=0.8] -->
<!-- begin figure -->

<img src="fig-alg/fd_backward.png" width="400" class="r-stretch"><p style="font-size: 0.9em">
</p><p><i>Figure 1</i></p>
<p></p>
<!-- end figure -->
</section>
<section id="the-backward-euler-scheme" class="slide level2">
<h2>The Backward Euler scheme</h2>
<p>Inserting the finite difference approximation in <span class="math inline">\(u'(t_n)=-au(t_n)\)</span> yields the Backward Euler (BE) scheme:</p>
<!-- Equation labels as ordinary links -->
<div id="decay:BE0">

</div>
<p><span class="math display">\[
\begin{equation}
\frac{u^{n}-u^{n-1}}{t_{n}-t_{n-1}} = -a u^n
\label{decay:BE0} \tag{9}
\end{equation}
\]</span></p>
<p>Solve with respect to the unknown <span class="math inline">\(u^{n+1}\)</span>:</p>
<!-- Equation labels as ordinary links -->
<div id="decay:BE">

</div>
<p><span class="math display">\[
\begin{equation}
u^{n+1} = \frac{1}{1+ a(t_{n+1}-t_n)} u^n
\label{decay:BE} \tag{10}
\end{equation}
\]</span></p>
</section>
<section id="a-centered-difference" class="slide level2">
<h2>A centered difference</h2>
<p>Centered differences are better approximations than forward or backward differences.</p>
<!-- dom:FIGURE: [fig-alg/fd_centered_CN.png, width=400 frac=0.8] -->
<!-- begin figure -->

<img src="fig-alg/fd_centered_CN.png" width="400" class="r-stretch"><p style="font-size: 0.9em">
</p><p><i>Figure 1</i></p>
<p></p>
<!-- end figure -->
</section>
<section id="the-crank-nicolson-scheme-ideas" class="slide level2">
<h2>The Crank-Nicolson scheme; ideas</h2>
<div id="decay:schemes:CN">

</div>
<p>Idea 1: let the ODE hold at <span class="math inline">\(t_{n+\frac{1}{2}}\)</span></p>
<p><span class="math display">\[
u'(t_{n+\frac{1}{2}}) = -au(t_{n+\frac{1}{2}})
\]</span></p>
<p>Idea 2: approximate <span class="math inline">\(u'(t_{n+\frac{1}{2}})\)</span> by a centered difference</p>
<!-- Equation labels as ordinary links -->
<div id="decay:CNdiff">

</div>
<p><span class="math display">\[
\begin{equation}
u'(t_{n+\frac{1}{2}}) \approx \frac{u^{n+1}-u^n}{t_{n+1}-t_n}
\label{decay:CNdiff} \tag{11}
\end{equation}
\]</span></p>
<p>Problem: <span class="math inline">\(u(t_{n+\frac{1}{2}})\)</span> is not defined, only <span class="math inline">\(u^n=u(t_n)\)</span> and <span class="math inline">\(u^{n+1}=u(t_{n+1})\)</span></p>
<p>Solution:</p>
<p><span class="math display">\[
u(t_{n+\frac{1}{2}}) \approx \frac{1}{2}(u^n + u^{n+1})
\]</span></p>
</section>
<section id="the-crank-nicolson-scheme-result" class="slide level2">
<h2>The Crank-Nicolson scheme; result</h2>
<p>Result:</p>
<!-- Equation labels as ordinary links -->
<div id="decay:CN1">

</div>
<p><span class="math display">\[
\begin{equation}
\frac{u^{n+1}-u^n}{t_{n+1}-t_n} = -a\frac{1}{2} (u^n + u^{n+1})
\label{decay:CN1} \tag{12}
\end{equation}
\]</span></p>
<p>Solve wrt to <span class="math inline">\(u^{n+1}\)</span>:</p>
<!-- Equation labels as ordinary links -->
<div id="decay:CN">

</div>
<p><span class="math display">\[
\begin{equation}
u^{n+1} = \frac{1-\frac{1}{2} a(t_{n+1}-t_n)}{1 + \frac{1}{2} a(t_{n+1}-t_n)}u^n
\label{decay:CN} \tag{13}
\end{equation}
\]</span></p>
<p>This is a Crank-Nicolson (CN) scheme or a midpoint or centered scheme.</p>
</section>
<section id="the-unifying-theta-rule" class="slide level2">
<h2>The unifying <span class="math inline">\(\theta\)</span>-rule</h2>
<div id="decay:schemes:theta">

</div>
<p>The Forward Euler, Backward Euler, and Crank-Nicolson schemes can be formulated as one scheme with a varying parameter <span class="math inline">\(\theta\)</span>:</p>
<!-- Equation labels as ordinary links -->
<div id="decay:th0">

</div>
<p><span class="math display">\[
\begin{equation}
\frac{u^{n+1}-u^{n}}{t_{n+1}-t_n} = -a (\theta u^{n+1} + (1-\theta) u^{n})
\label{decay:th0} \tag{14}
\end{equation}
\]</span></p>
<ul>
<li><p><span class="math inline">\(\theta =0\)</span>: Forward Euler</p></li>
<li><p><span class="math inline">\(\theta =1\)</span>: Backward Euler</p></li>
<li><p><span class="math inline">\(\theta =1/2\)</span>: Crank-Nicolson</p></li>
<li><p>We may alternatively choose any <span class="math inline">\(\theta\in [0,1]\)</span>.</p></li>
</ul>
<p><span class="math inline">\(u^n\)</span> is known, solve for <span class="math inline">\(u^{n+1}\)</span>:</p>
<!-- Equation labels as ordinary links -->
<div id="decay:th">

</div>
<p><span class="math display">\[
\begin{equation}
u^{n+1} = \frac{1 - (1-\theta) a(t_{n+1}-t_n)}{1 + \theta a(t_{n+1}-t_n)} u^n
\label{decay:th} \tag{15}
\end{equation}
\]</span></p>
</section>
<section id="constant-time-step" class="slide level2">
<h2>Constant time step</h2>
<p>Very common assumption (not important, but exclusively used for simplicity hereafter): constant time step <span class="math inline">\(t_{n+1}-t_n\equiv\Delta t\)</span></p>
<p><strong>Summary of schemes for constant time step.</strong></p>
<!-- Equation labels as ordinary links -->
<div id="decay:FE:u">

</div>
<p><span class="math display">\[
\begin{equation}
u^{n+1} = (1 - a\Delta t )u^n  \quad (\hbox{FE})
\label{decay:FE:u} \tag{16}
\end{equation}
\]</span></p>
<!-- Equation labels as ordinary links -->
<div id="decay:BE:u">

</div>
<p><span class="math display">\[
\begin{equation}
u^{n+1} = \frac{1}{1+ a\Delta t} u^n  \quad (\hbox{BE})
\label{decay:BE:u} \tag{17}
\end{equation}
\]</span></p>
<!-- Equation labels as ordinary links -->
<div id="decay:CN:u">

</div>
<p><span class="math display">\[
\begin{equation}
u^{n+1} = \frac{1-\frac{1}{2} a\Delta t}{1 + \frac{1}{2} a\Delta t} u^n \quad (\hbox{CN})
\label{decay:CN:u} \tag{18}
\end{equation}
\]</span></p>
<!-- Equation labels as ordinary links -->
<div id="decay:th:u">

</div>
<p><span class="math display">\[
\begin{equation}
u^{n+1} = \frac{1 - (1-\theta) a\Delta t}{1 + \theta a\Delta t}u^n \quad (\theta-\hbox{rule})
\label{decay:th:u} \tag{19}
\end{equation}
\]</span></p>
</section>
<section id="test-the-understanding" class="slide level2">
<h2>Test the understanding!</h2>
<p>Derive Forward Euler, Backward Euler, and Crank-Nicolson schemes for Newton’s law of cooling:</p>
<p><span class="math display">\[
T' = -k(T-T_s),\quad T(0)=T_0,\ t\in (0,t_{\mbox{end}}]
\]</span></p>
<p>Physical quantities:</p>
<ul>
<li><p><span class="math inline">\(T(t)\)</span>: temperature of an object at time <span class="math inline">\(t\)</span></p></li>
<li><p><span class="math inline">\(k\)</span>: parameter expressing heat loss to the surroundings</p></li>
<li><p><span class="math inline">\(T_s\)</span>: temperature of the surroundings</p></li>
<li><p><span class="math inline">\(T_0\)</span>: initial temperature</p></li>
</ul>
</section>
<section id="compact-operator-notation-for-finite-differences" class="slide level2">
<h2>Compact operator notation for finite differences</h2>
<div id="decay:fd:op">

</div>
<ul>
<li><p>Finite difference formulas can be tedious to write and read/understand</p></li>
<li><p>Handy tool: finite difference operator notation</p></li>
<li><p>Advantage: communicates the nature of the difference in a compact way</p></li>
</ul>
<!-- Equation labels as ordinary links -->
<div id="_auto2">

</div>
<p><span class="math display">\[
\begin{equation}
[D_t^- u  = -au]^n
\label{_auto2} \tag{20}
\end{equation}
\]</span></p>
</section>
<section id="specific-notation-for-difference-operators" class="slide level2">
<h2>Specific notation for difference operators</h2>
<p>Forward difference:</p>
<!-- Equation labels as ordinary links -->
<div id="fd:D:f">

</div>
<p><span class="math display">\[
\begin{equation}
[D_t^+u]^n = \frac{u^{n+1} - u^{n}}{\Delta t}
\approx \frac{d}{dt} u(t_n) \label{fd:D:f} \tag{21}
\end{equation}
\]</span></p>
<p>Centered difference (around <span class="math inline">\(t_n\)</span>):</p>
<!-- Equation labels as ordinary links -->
<div id="fd:D:c">

</div>
<p><span class="math display">\[
\begin{equation}
[D_tu]^n = \frac{u^{n+\frac{1}{2}} - u^{n-\frac{1}{2}}}{\Delta t}
\approx \frac{d}{dt} u(t_n), \label{fd:D:c} \tag{22}
\end{equation}
\]</span></p>
<p>Backward difference:</p>
<!-- Equation labels as ordinary links -->
<div id="fd:D:b">

</div>
<p><span class="math display">\[
\begin{equation}
[D_t^-u]^n = \frac{u^{n} - u^{n-1}}{\Delta t}
\approx \frac{d}{dt} u(t_n) \label{fd:D:b} \tag{23}
\end{equation}
\]</span></p>
</section>
<section id="the-backward-euler-scheme-with-operator-notation" class="slide level2">
<h2>The Backward Euler scheme with operator notation</h2>
<p><span class="math display">\[
[D_t^-u]^n = -au^n
\]</span></p>
<p>Common to put the whole equation inside square brackets:</p>
<!-- Equation labels as ordinary links -->
<div id="_auto3">

</div>
<p><span class="math display">\[
\begin{equation}
[D_t^- u  = -au]^n
\label{_auto3} \tag{24}
\end{equation}
\]</span></p>
</section>
<section id="the-forward-euler-scheme-with-operator-notation" class="slide level2">
<h2>The Forward Euler scheme with operator notation</h2>
<!-- Equation labels as ordinary links -->
<div id="_auto4">

</div>
<p><span class="math display">\[
\begin{equation}
[D_t^+ u  = -au]^n
\label{_auto4} \tag{25}
\end{equation}
\]</span></p>
</section>
<section id="the-crank-nicolson-scheme-with-operator-notation" class="slide level2">
<h2>The Crank-Nicolson scheme with operator notation</h2>
<p>Introduce an averaging operator:</p>
<!-- Equation labels as ordinary links -->
<div id="fd:mean:a">

</div>
<p><span class="math display">\[
\begin{equation}
[\overline{u}^{t}]^n = \frac{1}{2} (u^{n-\frac{1}{2}} + u^{n+\frac{1}{2}} )
\approx u(t_n) \label{fd:mean:a} \tag{26}
\end{equation}
\]</span></p>
<p>The Crank-Nicolson scheme can then be written as</p>
<!-- Equation labels as ordinary links -->
<div id="fd:compact:ex:CN">

</div>
<p><span class="math display">\[
\begin{equation}
[D_t u = -a\overline{u}^t]^{n+\frac{1}{2}}
\label{fd:compact:ex:CN} \tag{27}
\end{equation}
\]</span></p>
<p>Test: use the definitions and write out the above formula to see that it really is the Crank-Nicolson scheme!</p>
</section></section>
<section>
<section id="implementation" class="title-slide slide level1 center">
<h1>Implementation</h1>
<div id="decay:impl1">

</div>
<p>Model:</p>
<p><span class="math display">\[
u'(t) = -au(t),\quad t\in (0,T], \quad u(0)=I
\]</span></p>
<p>Numerical method:</p>
<p><span class="math display">\[
u^{n+1} = \frac{1 - (1-\theta) a\Delta t}{1 + \theta a\Delta t}u^n
\]</span></p>
<p>for <span class="math inline">\(\theta\in [0,1]\)</span>. Note</p>
<ul>
<li><p><span class="math inline">\(\theta=0\)</span> gives Forward Euler</p></li>
<li><p><span class="math inline">\(\theta=1\)</span> gives Backward Euler</p></li>
<li><p><span class="math inline">\(\theta=1/2\)</span> gives Crank-Nicolson</p></li>
</ul>
</section>
<section id="requirements-of-a-program" class="slide level2">
<h2>Requirements of a program</h2>
<ul>
<li><p>Compute the numerical solution <span class="math inline">\(u^n\)</span>, <span class="math inline">\(n=1,2,\ldots,N_t\)</span></p></li>
<li><p>Display the numerical and exact solution <span class="math inline">\(u_{\mbox{\footnotesize e}}(t)=e^{-at}\)</span></p></li>
<li><p>Bring evidence to a correct implementation (<em>verification</em>)</p></li>
<li><p>Compare the numerical and the exact solution in a plot</p></li>
<li><p>Compute the error <span class="math inline">\(u_{\mbox{\footnotesize e}} (t_n) - u^n\)</span></p></li>
<li><p>Read its input data from the command line</p></li>
</ul>
</section>
<section id="tools-to-learn" class="slide level2">
<h2>Tools to learn</h2>
<ul>
<li><p>Basic <a href="http://python.org">Python</a> programming</p></li>
<li><p>Array computing with <a href="http://numpy.org/"><code>numpy</code></a></p></li>
<li><p>Plotting with <a href="http://matplotlib.sourceforge.net/"><code>matplotlib.pyplot</code></a> and <a href="https://github.com/hplgit/scitools/"><code>scitools</code></a></p></li>
<li><p>File writing and reading</p></li>
</ul>
<p><strong>Notice.</strong></p>
<p>All programs are in the directory <a href="http://tinyurl.com/ofkw6kc/alg"><code>src/alg</code></a>.</p>
</section>
<section id="why-implement-in-python" class="slide level2">
<h2>Why implement in Python?</h2>
<ul>
<li><p>Python has a very clean, readable syntax (often known as “executable pseudo-code”).</p></li>
<li><p>Python code is very similar to MATLAB code (and MATLAB has a particularly widespread use for scientific computing).</p></li>
<li><p>Python is a full-fledged, very powerful programming language.</p></li>
<li><p>Python is similar to, but much simpler to work with and results in more reliable code than C++.</p></li>
</ul>
</section>
<section id="why-implement-in-python-1" class="slide level2">
<h2>Why implement in Python?</h2>
<ul>
<li><p>Python has a rich set of modules for scientific computing, and its popularity in scientific computing is rapidly growing.</p></li>
<li><p>Python was made for being combined with compiled languages (C, C++, Fortran) to reuse existing numerical software and to reach high computational performance of new implementations.</p></li>
<li><p>Python has extensive support for administrative task needed when doing large-scale computational investigations.</p></li>
<li><p>Python has extensive support for graphics (visualization, user interfaces, web applications).</p></li>
<li><p>FEniCS, a very powerful tool for solving PDEs by the finite element method, is most human-efficient to operate from Python.</p></li>
</ul>
</section>
<section id="algorithm" class="slide level2">
<h2>Algorithm</h2>
<div id="decay:py1">

</div>
<ul>
<li><p>Store <span class="math inline">\(u^n\)</span>, <span class="math inline">\(n=0,1,\ldots,N_t\)</span> in an array <code>u</code>.</p></li>
<li><p>Algorithm:</p></li>
</ul>
<ol type="a">
<li><p>initialize <span class="math inline">\(u^0\)</span></p></li>
<li><p>for <span class="math inline">\(t=t_n\)</span>, <span class="math inline">\(n=1,2,\ldots,N_t\)</span>: compute <span class="math inline">\(u_n\)</span> using the <span class="math inline">\(\theta\)</span>-rule formula</p></li>
</ol>
</section>
<section id="translation-to-python-function" class="slide level2">
<h2>Translation to Python function</h2>
<div class="cell" data-editable="true" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1"></a><span class="im">from</span> numpy <span class="im">import</span> <span class="op">*</span></span>
<span id="cb1-2"><a href="#cb1-2"></a></span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="kw">def</span> solver(I, a, T, dt, theta):</span>
<span id="cb1-4"><a href="#cb1-4"></a>    <span class="co">"""Solve u'=-a*u, u(0)=I, for t in (0,T] with steps of dt."""</span></span>
<span id="cb1-5"><a href="#cb1-5"></a>    Nt <span class="op">=</span> <span class="bu">int</span>(T<span class="op">/</span>dt)            <span class="co"># no of time intervals</span></span>
<span id="cb1-6"><a href="#cb1-6"></a>    T <span class="op">=</span> Nt<span class="op">*</span>dt                 <span class="co"># adjust T to fit time step dt</span></span>
<span id="cb1-7"><a href="#cb1-7"></a>    u <span class="op">=</span> zeros(Nt<span class="op">+</span><span class="dv">1</span>)           <span class="co"># array of u[n] values</span></span>
<span id="cb1-8"><a href="#cb1-8"></a>    t <span class="op">=</span> linspace(<span class="dv">0</span>, T, Nt<span class="op">+</span><span class="dv">1</span>)  <span class="co"># time mesh</span></span>
<span id="cb1-9"><a href="#cb1-9"></a></span>
<span id="cb1-10"><a href="#cb1-10"></a>    u[<span class="dv">0</span>] <span class="op">=</span> I                  <span class="co"># assign initial condition</span></span>
<span id="cb1-11"><a href="#cb1-11"></a>    <span class="cf">for</span> n <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, Nt):    <span class="co"># n=0,1,...,Nt-1</span></span>
<span id="cb1-12"><a href="#cb1-12"></a>        u[n<span class="op">+</span><span class="dv">1</span>] <span class="op">=</span> (<span class="dv">1</span> <span class="op">-</span> (<span class="dv">1</span><span class="op">-</span>theta)<span class="op">*</span>a<span class="op">*</span>dt)<span class="op">/</span>(<span class="dv">1</span> <span class="op">+</span> theta<span class="op">*</span>dt<span class="op">*</span>a)<span class="op">*</span>u[n]</span>
<span id="cb1-13"><a href="#cb1-13"></a>    <span class="cf">return</span> u, t</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note about the <code>for</code> loop: <code>range(0, Nt, s)</code> generates all integers from <code>0</code> to <code>Nt</code> in steps of <code>s</code> (default 1), <em>but not including</em> <code>Nt</code> (!).</p>
<p>Sample call:</p>
<div class="cell" data-editable="true" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1"></a>u, t <span class="op">=</span> solver(I<span class="op">=</span><span class="dv">1</span>, a<span class="op">=</span><span class="dv">2</span>, T<span class="op">=</span><span class="dv">8</span>, dt<span class="op">=</span><span class="fl">0.8</span>, theta<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="integer-division" class="slide level2">
<h2>Integer division</h2>
<p>Python applies integer division: <code>1/2</code> is 0, while <code>1./2</code> or <code>1.0/2</code> or <code>1/2.</code> or <code>1/2.0</code> or <code>1.0/2.0</code> all give 0.5.</p>
<p>A safer <code>solver</code> function (<code>dt = float(dt)</code> - guarantee float):</p>
<div class="cell" data-editable="true" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1"></a><span class="im">from</span> numpy <span class="im">import</span> <span class="op">*</span></span>
<span id="cb3-2"><a href="#cb3-2"></a></span>
<span id="cb3-3"><a href="#cb3-3"></a><span class="kw">def</span> solver(I, a, T, dt, theta):</span>
<span id="cb3-4"><a href="#cb3-4"></a>    <span class="co">"""Solve u'=-a*u, u(0)=I, for t in (0,T] with steps of dt."""</span></span>
<span id="cb3-5"><a href="#cb3-5"></a>    dt <span class="op">=</span> <span class="bu">float</span>(dt)            <span class="co"># avoid integer division</span></span>
<span id="cb3-6"><a href="#cb3-6"></a>    Nt <span class="op">=</span> <span class="bu">int</span>(<span class="bu">round</span>(T<span class="op">/</span>dt))     <span class="co"># no of time intervals</span></span>
<span id="cb3-7"><a href="#cb3-7"></a>    T <span class="op">=</span> Nt<span class="op">*</span>dt                 <span class="co"># adjust T to fit time step dt</span></span>
<span id="cb3-8"><a href="#cb3-8"></a>    u <span class="op">=</span> zeros(Nt<span class="op">+</span><span class="dv">1</span>)           <span class="co"># array of u[n] values</span></span>
<span id="cb3-9"><a href="#cb3-9"></a>    t <span class="op">=</span> linspace(<span class="dv">0</span>, T, Nt<span class="op">+</span><span class="dv">1</span>)  <span class="co"># time mesh</span></span>
<span id="cb3-10"><a href="#cb3-10"></a></span>
<span id="cb3-11"><a href="#cb3-11"></a>    u[<span class="dv">0</span>] <span class="op">=</span> I                  <span class="co"># assign initial condition</span></span>
<span id="cb3-12"><a href="#cb3-12"></a>    <span class="cf">for</span> n <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, Nt):    <span class="co"># n=0,1,...,Nt-1</span></span>
<span id="cb3-13"><a href="#cb3-13"></a>        u[n<span class="op">+</span><span class="dv">1</span>] <span class="op">=</span> (<span class="dv">1</span> <span class="op">-</span> (<span class="dv">1</span><span class="op">-</span>theta)<span class="op">*</span>a<span class="op">*</span>dt)<span class="op">/</span>(<span class="dv">1</span> <span class="op">+</span> theta<span class="op">*</span>dt<span class="op">*</span>a)<span class="op">*</span>u[n]</span>
<span id="cb3-14"><a href="#cb3-14"></a>    <span class="cf">return</span> u, t</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="doc-strings" class="slide level2">
<h2>Doc strings</h2>
<ul>
<li><p>First string after the function heading</p></li>
<li><p>Used for documenting the function</p></li>
<li><p>Automatic documentation tools can make fancy manuals for you</p></li>
<li><p>Can be used for automatic testing</p></li>
</ul>
<div class="cell" data-editable="true" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1"></a><span class="kw">def</span> solver(I, a, T, dt, theta):</span>
<span id="cb4-2"><a href="#cb4-2"></a>    <span class="co">"""</span></span>
<span id="cb4-3"><a href="#cb4-3"></a><span class="co">    Solve</span></span>
<span id="cb4-4"><a href="#cb4-4"></a></span>
<span id="cb4-5"><a href="#cb4-5"></a><span class="co">        u'(t) = -a*u(t),</span></span>
<span id="cb4-6"><a href="#cb4-6"></a></span>
<span id="cb4-7"><a href="#cb4-7"></a><span class="co">    with initial condition u(0)=I, for t in the time interval</span></span>
<span id="cb4-8"><a href="#cb4-8"></a><span class="co">    (0,T]. The time interval is divided into time steps of</span></span>
<span id="cb4-9"><a href="#cb4-9"></a><span class="co">    length dt.</span></span>
<span id="cb4-10"><a href="#cb4-10"></a></span>
<span id="cb4-11"><a href="#cb4-11"></a><span class="co">    theta=1 corresponds to the Backward Euler scheme, theta=0</span></span>
<span id="cb4-12"><a href="#cb4-12"></a><span class="co">    to the Forward Euler scheme, and theta=0.5 to the Crank-</span></span>
<span id="cb4-13"><a href="#cb4-13"></a><span class="co">    Nicolson method.</span></span>
<span id="cb4-14"><a href="#cb4-14"></a><span class="co">    """</span></span>
<span id="cb4-15"><a href="#cb4-15"></a>    ...</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="formatting-of-numbers" class="slide level2">
<h2>Formatting of numbers</h2>
<p>Can control formatting of reals and integers through the <em>printf</em> format:</p>
<div class="cell" data-editable="true" data-execution_count="5">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1"></a><span class="bu">print</span> <span class="st">'t=</span><span class="sc">%6.3f</span><span class="st"> u=</span><span class="sc">%g</span><span class="st">'</span> <span class="op">%</span> (t[i], u[i])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Or the alternative <em>format string syntax</em>:</p>
<div class="cell" data-editable="true" data-execution_count="6">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1"></a><span class="bu">print</span> <span class="st">'t=</span><span class="sc">{t:6.3f}</span><span class="st"> u=</span><span class="sc">{u:g}</span><span class="st">'</span>.<span class="bu">format</span>(t<span class="op">=</span>t[i], u<span class="op">=</span>u[i])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="running-the-program" class="slide level2">
<h2>Running the program</h2>
<p>How to run the program <a href="http://tinyurl.com/ofkw6kc/alg/decay_v1.py"><code>decay_v1.py</code></a>.</p>
<pre><code>    Terminal&gt; python decay_v1.py</code></pre>
<p>Can also run it as “normal” Unix programs: <code>./decay_v1.py</code> if the first line is</p>
<div class="cell" data-editable="true" data-execution_count="7">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1"></a>`<span class="co">#!/usr/bin/env python`</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then</p>
<pre><code>    Terminal&gt; chmod a+rx decay_v1.py
    Terminal&gt; ./decay_v1.py</code></pre>
</section>
<section id="plotting-the-solution" class="slide level2">
<h2>Plotting the solution</h2>
<p>Basic syntax:</p>
<div class="cell" data-editable="true" data-execution_count="8">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1"></a><span class="op">%</span>matplotlib inline</span>
<span id="cb10-2"><a href="#cb10-2"></a></span>
<span id="cb10-3"><a href="#cb10-3"></a><span class="im">from</span> matplotlib.pyplot <span class="im">import</span> <span class="op">*</span></span>
<span id="cb10-4"><a href="#cb10-4"></a></span>
<span id="cb10-5"><a href="#cb10-5"></a>plot(t, u)</span>
<span id="cb10-6"><a href="#cb10-6"></a>show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Can (and should!) add labels on axes, title, legends.</p>
</section>
<section id="comparing-with-the-exact-solution" class="slide level2">
<h2>Comparing with the exact solution</h2>
<p>Python function for the exact solution <span class="math inline">\(u_{\mbox{\footnotesize e}}(t)=Ie^{-at}\)</span>:</p>
<div class="cell" data-editable="true" data-execution_count="9">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1"></a><span class="kw">def</span> u_exact(t, I, a):</span>
<span id="cb11-2"><a href="#cb11-2"></a>    <span class="cf">return</span> I<span class="op">*</span>exp(<span class="op">-</span>a<span class="op">*</span>t)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Quick plotting:</p>
<div class="cell" data-editable="true" data-execution_count="10">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1"></a>u_e <span class="op">=</span> u_exact(t, I, a)</span>
<span id="cb12-2"><a href="#cb12-2"></a>plot(t, u, t, u_e)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Problem: <span class="math inline">\(u_{\mbox{\footnotesize e}}(t)\)</span> applies the same mesh as <span class="math inline">\(u^n\)</span> and looks as a piecewise linear function.</p>
<p>Remedy: Introduce a very fine mesh for <span class="math inline">\(u_{\mbox{\footnotesize e}}\)</span>.</p>
<div class="cell" data-editable="true" data-execution_count="11">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1"></a>t_e <span class="op">=</span> linspace(<span class="dv">0</span>, T, <span class="dv">1001</span>)      <span class="co"># fine mesh</span></span>
<span id="cb13-2"><a href="#cb13-2"></a>u_e <span class="op">=</span> u_exact(t_e, I, a)</span>
<span id="cb13-3"><a href="#cb13-3"></a></span>
<span id="cb13-4"><a href="#cb13-4"></a>plot(t_e, u_e, <span class="st">'b-'</span>,            <span class="co"># blue line for u_e</span></span>
<span id="cb13-5"><a href="#cb13-5"></a>     t,   u,   <span class="st">'r--o'</span>)          <span class="co"># red dashes w/circles</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="add-legends-axes-labels-title-and-wrap-in-a-function" class="slide level2">
<h2>Add legends, axes labels, title, and wrap in a function</h2>
<div class="cell" data-editable="true" data-execution_count="12">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1"></a><span class="im">from</span> matplotlib.pyplot <span class="im">import</span> <span class="op">*</span></span>
<span id="cb14-2"><a href="#cb14-2"></a></span>
<span id="cb14-3"><a href="#cb14-3"></a><span class="kw">def</span> plot_numerical_and_exact(theta, I, a, T, dt):</span>
<span id="cb14-4"><a href="#cb14-4"></a>    <span class="co">"""Compare the numerical and exact solution in a plot."""</span></span>
<span id="cb14-5"><a href="#cb14-5"></a>    u, t <span class="op">=</span> solver(I<span class="op">=</span>I, a<span class="op">=</span>a, T<span class="op">=</span>T, dt<span class="op">=</span>dt, theta<span class="op">=</span>theta)</span>
<span id="cb14-6"><a href="#cb14-6"></a></span>
<span id="cb14-7"><a href="#cb14-7"></a>    t_e <span class="op">=</span> linspace(<span class="dv">0</span>, T, <span class="dv">1001</span>)        <span class="co"># fine mesh for u_e</span></span>
<span id="cb14-8"><a href="#cb14-8"></a>    u_e <span class="op">=</span> u_exact(t_e, I, a)</span>
<span id="cb14-9"><a href="#cb14-9"></a></span>
<span id="cb14-10"><a href="#cb14-10"></a>    plot(t,   u,   <span class="st">'r--o'</span>,            <span class="co"># red dashes w/circles</span></span>
<span id="cb14-11"><a href="#cb14-11"></a>         t_e, u_e, <span class="st">'b-'</span>)              <span class="co"># blue line for exact sol.</span></span>
<span id="cb14-12"><a href="#cb14-12"></a>    legend([<span class="st">'numerical'</span>, <span class="st">'exact'</span>])</span>
<span id="cb14-13"><a href="#cb14-13"></a>    xlabel(<span class="st">'t'</span>)</span>
<span id="cb14-14"><a href="#cb14-14"></a>    ylabel(<span class="st">'u'</span>)</span>
<span id="cb14-15"><a href="#cb14-15"></a>    title(<span class="st">'theta=</span><span class="sc">%g</span><span class="st">, dt=</span><span class="sc">%g</span><span class="st">'</span> <span class="op">%</span> (theta, dt))</span>
<span id="cb14-16"><a href="#cb14-16"></a>    savefig(<span class="st">'plot_</span><span class="sc">%s</span><span class="st">_</span><span class="sc">%g</span><span class="st">.png'</span> <span class="op">%</span> (theta, dt))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Complete code in <a href="http://tinyurl.com/ofkw6kc/alg/decay_v2.py"><code>decay_v2.py</code></a></p>
<!-- dom:FIGURE: [fig-alg/decay_v2.png, width=500 frac=0.8] -->
<!-- begin figure -->

<img src="fig-alg/decay_v2.png" width="500" class="r-stretch"><p style="font-size: 0.9em">
</p><p><i>Figure 1</i></p>
<p></p>
<!-- end figure -->
</section>
<section id="plotting-with-scitools" class="slide level2">
<h2>Plotting with SciTools</h2>
<p><a href="https://github.com/hplgit/scitools">SciTools</a> provides a unified plotting interface (Easyviz) to many different plotting packages: Matplotlib, Gnuplot, Grace, VTK, OpenDX, …</p>
<p>Can use Matplotlib (MATLAB-like) syntax, or a more compact <code>plot</code> function syntax:</p>
<div class="cell" data-editable="true" data-execution_count="13">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1"></a><span class="im">from</span> scitools.std <span class="im">import</span> <span class="op">*</span></span>
<span id="cb15-2"><a href="#cb15-2"></a></span>
<span id="cb15-3"><a href="#cb15-3"></a>plot(t,   u,   <span class="st">'r--o'</span>,           <span class="co"># red dashes w/circles</span></span>
<span id="cb15-4"><a href="#cb15-4"></a>     t_e, u_e, <span class="st">'b-'</span>,             <span class="co"># blue line for exact sol.</span></span>
<span id="cb15-5"><a href="#cb15-5"></a>     legend<span class="op">=</span>[<span class="st">'numerical'</span>, <span class="st">'exact'</span>],</span>
<span id="cb15-6"><a href="#cb15-6"></a>     xlabel<span class="op">=</span><span class="st">'t'</span>,</span>
<span id="cb15-7"><a href="#cb15-7"></a>     ylabel<span class="op">=</span><span class="st">'u'</span>,</span>
<span id="cb15-8"><a href="#cb15-8"></a>     title<span class="op">=</span><span class="st">'theta=</span><span class="sc">%g</span><span class="st">, dt=</span><span class="sc">%g</span><span class="st">'</span> <span class="op">%</span> (theta, dt),</span>
<span id="cb15-9"><a href="#cb15-9"></a>     savefig<span class="op">=</span><span class="st">'</span><span class="sc">%s</span><span class="st">_</span><span class="sc">%g</span><span class="st">.png'</span> <span class="op">%</span> (theta2name[theta], dt),</span>
<span id="cb15-10"><a href="#cb15-10"></a>     show<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Change backend (plotting engine, Matplotlib by default):</p>
<pre><code>    Terminal&gt; python decay_plot_st.py --SCITOOLS_easyviz_backend gnuplot
    Terminal&gt; python decay_plot_st.py --SCITOOLS_easyviz_backend grace</code></pre>
</section></section>
<section>
<section id="verifying-the-implementation" class="title-slide slide level1 center">
<h1>Verifying the implementation</h1>
<div id="decay:verification">

</div>
<ul>
<li><p>Verification = bring evidence that the program works</p></li>
<li><p>Find suitable test problems</p></li>
<li><p>Make function for each test problem</p></li>
<li><p>Later: put the verification tests in a professional testing framework</p></li>
</ul>
</section>
<section id="simplest-method-run-a-few-algorithmic-steps-by-hand" class="slide level2">
<h2>Simplest method: run a few algorithmic steps by hand</h2>
<p>Use a calculator (<span class="math inline">\(I=0.1\)</span>, <span class="math inline">\(\theta=0.8\)</span>, <span class="math inline">\(\Delta t =0.8\)</span>):</p>
<p><span class="math display">\[
A\equiv \frac{1 - (1-\theta) a\Delta t}{1 + \theta a \Delta t} = 0.298245614035
\]</span></p>
<p><span class="math display">\[
\begin{align*}
u^1 &amp;= AI=0.0298245614035,\\
u^2 &amp;= Au^1= 0.00889504462912,\\
u^3 &amp;=Au^2= 0.00265290804728
\end{align*}
\]</span></p>
<p>See the function <code>test_solver_three_steps</code> in <a href="http://tinyurl.com/ofkw6kc/alg/decay_v3.py"><code>decay_v3.py</code></a>.</p>
</section>
<section id="comparison-with-an-exact-discrete-solution" class="slide level2">
<h2>Comparison with an exact discrete solution</h2>
<p><strong>Best verification.</strong></p>
<p>Compare computed numerical solution with a closed-form <em>exact discrete solution</em> (if possible).</p>
<p>Define</p>
<p><span class="math display">\[
A = \frac{1 - (1-\theta) a\Delta t}{1 + \theta a \Delta t}
\]</span></p>
<p>Repeated use of the <span class="math inline">\(\theta\)</span>-rule:</p>
<p><span class="math display">\[
\begin{align*}
u^0 &amp;= I,\\
u^1 &amp;= Au^0 = AI\\
u^n &amp;= A^nu^{n-1} = A^nI
\end{align*}
\]</span></p>
</section>
<section id="making-a-test-based-on-an-exact-discrete-solution" class="slide level2">
<h2>Making a test based on an exact discrete solution</h2>
<p>The exact discrete solution is</p>
<!-- Equation labels as ordinary links -->
<div id="decay:un:exact">

</div>
<p><span class="math display">\[
\begin{equation}
u^n = IA^n
\label{decay:un:exact} \tag{28}
\end{equation}
\]</span></p>
<p><strong>Question.</strong></p>
<p>Understand what <span class="math inline">\(n\)</span> in <span class="math inline">\(u^n\)</span> and in <span class="math inline">\(A^n\)</span> means!</p>
<p>Test if</p>
<p><span class="math display">\[
\max_n |u^n - u_{\mbox{\footnotesize e}}(t_n)| &lt; \epsilon\sim 10^{-15}
\]</span></p>
<p>Implementation in <a href="http://tinyurl.com/ofkw6kc/alg/decay_verf2.py"><code>decay_verf2.py</code></a>.</p>
</section>
<section id="test-the-understanding-1" class="slide level2">
<h2>Test the understanding!</h2>
<p>Make a program for solving Newton’s law of cooling</p>
<p><span class="math display">\[
T' = -k(T-T_s),\quad T(0)=T_0,\ t\in (0,t_{\mbox{end}}]
\]</span></p>
<p>with the Forward Euler, Backward Euler, and Crank-Nicolson schemes (or a <span class="math inline">\(\theta\)</span> scheme). Verify the implementation.</p>
</section>
<section id="computing-the-numerical-error-as-a-mesh-function" class="slide level2">
<h2>Computing the numerical error as a mesh function</h2>
<div id="decay:computing:error">

</div>
<p>Task: compute the numerical error <span class="math inline">\(e^n = u_{\mbox{\footnotesize e}}(t_n) - u^n\)</span></p>
<p>Exact solution: <span class="math inline">\(u_{\mbox{\footnotesize e}}(t)=Ie^{-at}\)</span>, implemented as</p>
<div class="cell" data-editable="true" data-execution_count="14">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1"></a><span class="kw">def</span> u_exact(t, I, a):</span>
<span id="cb17-2"><a href="#cb17-2"></a>    <span class="cf">return</span> I<span class="op">*</span>exp(<span class="op">-</span>a<span class="op">*</span>t)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Compute <span class="math inline">\(e^n\)</span> by</p>
<div class="cell" data-editable="true" data-execution_count="15">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1"></a>u, t <span class="op">=</span> solver(I, a, T, dt, theta)  <span class="co"># Numerical solution</span></span>
<span id="cb18-2"><a href="#cb18-2"></a>u_e <span class="op">=</span> u_exact(t, I, a)</span>
<span id="cb18-3"><a href="#cb18-3"></a>e <span class="op">=</span> u_e <span class="op">-</span> u</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Array arithmetics - we compute on entire arrays!</strong></p>
<ul>
<li><p><code>u_exact(t, I, a)</code> works with <code>t</code> as array</p></li>
<li><p>Must have <code>exp</code> from <code>numpy</code> (not <code>math</code>)</p></li>
<li><p><code>e = u_e - u</code>: array subtraction</p></li>
<li><p>Array arithmetics gives shorter and much faster code</p></li>
</ul>
</section>
<section id="computing-the-norm-of-the-error" class="slide level2">
<h2>Computing the norm of the error</h2>
<div id="decay:computing:error:norm">

</div>
<ul>
<li><p><span class="math inline">\(e^n\)</span> is a mesh function</p></li>
<li><p>Usually we want one number for the error</p></li>
<li><p>Use a norm of <span class="math inline">\(e^n\)</span></p></li>
</ul>
<p>Norms of a function <span class="math inline">\(f(t)\)</span>:</p>
<!-- Equation labels as ordinary links -->
<div id="decay:norms:L2">

</div>
<p><span class="math display">\[
\begin{equation}
||f||_{L^2} = \left( \int_0^T f(t)^2 dt\right)^{1/2}
\label{decay:norms:L2} \tag{29}
\end{equation}
\]</span></p>
<!-- Equation labels as ordinary links -->
<div id="decay:norms:L1">

</div>
<p><span class="math display">\[
\begin{equation}
||f||_{L^1} = \int_0^T |f(t)| dt
\label{decay:norms:L1} \tag{30}
\end{equation}
\]</span></p>
<!-- Equation labels as ordinary links -->
<div id="decay:norms:Linf">

</div>
<p><span class="math display">\[
\begin{equation}
||f||_{L^\infty} = \max_{t\in [0,T]}|f(t)|
\label{decay:norms:Linf} \tag{31}
\end{equation}
\]</span></p>
</section>
<section id="norms-of-mesh-functions" class="slide level2">
<h2>Norms of mesh functions</h2>
<ul>
<li><p>Problem: <span class="math inline">\(f^n =f(t_n)\)</span> is a mesh function and hence not defined for all <span class="math inline">\(t\)</span>. How to integrate <span class="math inline">\(f^n\)</span>?</p></li>
<li><p>Idea: Apply a numerical integration rule, using only the mesh points of the mesh function.</p></li>
</ul>
<p>The Trapezoidal rule:</p>
<p><span class="math display">\[
||f^n|| = \left(\Delta t\left(\frac{1}{2}(f^0)^2 + \frac{1}{2}(f^{N_t})^2
+ \sum_{n=1}^{N_t-1} (f^n)^2\right)\right)^{1/2}
\]</span></p>
<p>Common simplification yields the <span class="math inline">\(L^2\)</span> norm of a mesh function:</p>
<p><span class="math display">\[
||f^n||_{\ell^2} = \left(\Delta t\sum_{n=0}^{N_t} (f^n)^2\right)^{1/2}
\]</span></p>
</section>
<section id="implementation-of-the-norm-of-the-error" class="slide level2">
<h2>Implementation of the norm of the error</h2>
<p><span class="math display">\[
E = ||e^n||_{\ell^2}  = \sqrt{\Delta t\sum_{n=0}^{N_t} (e^n)^2}
\]</span></p>
<p>Python w/array arithmetics:</p>
<div class="cell" data-editable="true" data-execution_count="16">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1"></a>e <span class="op">=</span> u_exact(t) <span class="op">-</span> u</span>
<span id="cb19-2"><a href="#cb19-2"></a>E <span class="op">=</span> sqrt(dt<span class="op">*</span><span class="bu">sum</span>(e<span class="op">**</span><span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="comment-on-array-vs-scalar-computation" class="slide level2">
<h2>Comment on array vs scalar computation</h2>
<p>Scalar computing of <code>E = sqrt(dt*sum(e**2))</code>:</p>
<div class="cell" data-editable="true" data-execution_count="17">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1"></a>m <span class="op">=</span> <span class="bu">len</span>(u)     <span class="co"># length of u array (alt: u.size)</span></span>
<span id="cb20-2"><a href="#cb20-2"></a>u_e <span class="op">=</span> zeros(m)</span>
<span id="cb20-3"><a href="#cb20-3"></a>t <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb20-4"><a href="#cb20-4"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(m):</span>
<span id="cb20-5"><a href="#cb20-5"></a>    u_e[i] <span class="op">=</span> u_exact(t, a, I)</span>
<span id="cb20-6"><a href="#cb20-6"></a>    t <span class="op">=</span> t <span class="op">+</span> dt</span>
<span id="cb20-7"><a href="#cb20-7"></a>e <span class="op">=</span> zeros(m)</span>
<span id="cb20-8"><a href="#cb20-8"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(m):</span>
<span id="cb20-9"><a href="#cb20-9"></a>    e[i] <span class="op">=</span> u_e[i] <span class="op">-</span> u[i]</span>
<span id="cb20-10"><a href="#cb20-10"></a>s <span class="op">=</span> <span class="dv">0</span>  <span class="co"># summation variable</span></span>
<span id="cb20-11"><a href="#cb20-11"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(m):</span>
<span id="cb20-12"><a href="#cb20-12"></a>    s <span class="op">=</span> s <span class="op">+</span> e[i]<span class="op">**</span><span class="dv">2</span></span>
<span id="cb20-13"><a href="#cb20-13"></a>error <span class="op">=</span> sqrt(dt<span class="op">*</span>s)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Obviously, scalar computing</p>
<ul>
<li><p>takes more code</p></li>
<li><p>is less readable</p></li>
<li><p>runs much slower</p></li>
</ul>
<p><strong>Rule.</strong></p>
<p>Compute on entire arrays (when possible)!</p>
</section>
<section id="memory-saving-implementation" class="slide level2">
<h2>Memory-saving implementation</h2>
<ul>
<li><p>Note 1: we store the entire array <code>u</code>, i.e., <span class="math inline">\(u^n\)</span> for <span class="math inline">\(n=0,1,\ldots,N_t\)</span></p></li>
<li><p>Note 2: the formula for <span class="math inline">\(u^{n+1}\)</span> needs <span class="math inline">\(u^n\)</span> only, not <span class="math inline">\(u^{n-1}\)</span>, <span class="math inline">\(u^{n-2}\)</span>, …</p></li>
<li><p>No need to store more than <span class="math inline">\(u^{n+1}\)</span> and <span class="math inline">\(u^{n}\)</span></p></li>
<li><p>Extremely important when solving PDEs</p></li>
<li><p>No practical importance here (much memory available)</p></li>
<li><p>But let’s illustrate how to do save memory!</p></li>
<li><p>Idea 1: store <span class="math inline">\(u^{n+1}\)</span> in <code>u</code>, <span class="math inline">\(u^n\)</span> in <code>u_1</code> (<code>float</code>)</p></li>
<li><p>Idea 2: store <code>u</code> in a file, read file later for plotting</p></li>
</ul>
</section>
<section id="memory-saving-solver-function" class="slide level2">
<h2>Memory-saving solver function</h2>
<div class="cell" data-editable="true" data-execution_count="18">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1"></a><span class="kw">def</span> solver_memsave(I, a, T, dt, theta, filename<span class="op">=</span><span class="st">'sol.dat'</span>):</span>
<span id="cb21-2"><a href="#cb21-2"></a>    <span class="co">"""</span></span>
<span id="cb21-3"><a href="#cb21-3"></a><span class="co">    Solve u'=-a*u, u(0)=I, for t in (0,T] with steps of dt.</span></span>
<span id="cb21-4"><a href="#cb21-4"></a><span class="co">    Minimum use of memory. The solution is stored in a file</span></span>
<span id="cb21-5"><a href="#cb21-5"></a><span class="co">    (with name filename) for later plotting.</span></span>
<span id="cb21-6"><a href="#cb21-6"></a><span class="co">    """</span></span>
<span id="cb21-7"><a href="#cb21-7"></a>    dt <span class="op">=</span> <span class="bu">float</span>(dt)         <span class="co"># avoid integer division</span></span>
<span id="cb21-8"><a href="#cb21-8"></a>    Nt <span class="op">=</span> <span class="bu">int</span>(<span class="bu">round</span>(T<span class="op">/</span>dt))  <span class="co"># no of intervals</span></span>
<span id="cb21-9"><a href="#cb21-9"></a></span>
<span id="cb21-10"><a href="#cb21-10"></a>    outfile <span class="op">=</span> <span class="bu">open</span>(filename, <span class="st">'w'</span>)</span>
<span id="cb21-11"><a href="#cb21-11"></a>    <span class="co"># u: time level n+1, u_1: time level n</span></span>
<span id="cb21-12"><a href="#cb21-12"></a>    t <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb21-13"><a href="#cb21-13"></a>    u_1 <span class="op">=</span> I</span>
<span id="cb21-14"><a href="#cb21-14"></a>    outfile.write(<span class="st">'</span><span class="sc">%.16E</span><span class="st">  </span><span class="sc">%.16E</span><span class="ch">\n</span><span class="st">'</span> <span class="op">%</span> (t, u_1))</span>
<span id="cb21-15"><a href="#cb21-15"></a>    <span class="cf">for</span> n <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, Nt<span class="op">+</span><span class="dv">1</span>):</span>
<span id="cb21-16"><a href="#cb21-16"></a>        u <span class="op">=</span> (<span class="dv">1</span> <span class="op">-</span> (<span class="dv">1</span><span class="op">-</span>theta)<span class="op">*</span>a<span class="op">*</span>dt)<span class="op">/</span>(<span class="dv">1</span> <span class="op">+</span> theta<span class="op">*</span>dt<span class="op">*</span>a)<span class="op">*</span>u_1</span>
<span id="cb21-17"><a href="#cb21-17"></a>        u_1 <span class="op">=</span> u</span>
<span id="cb21-18"><a href="#cb21-18"></a>        t <span class="op">+=</span> dt</span>
<span id="cb21-19"><a href="#cb21-19"></a>        outfile.write(<span class="st">'</span><span class="sc">%.16E</span><span class="st">  </span><span class="sc">%.16E</span><span class="ch">\n</span><span class="st">'</span> <span class="op">%</span> (t, u))</span>
<span id="cb21-20"><a href="#cb21-20"></a>    outfile.close()</span>
<span id="cb21-21"><a href="#cb21-21"></a>    <span class="cf">return</span> u, t</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="reading-computed-data-from-file" class="slide level2">
<h2>Reading computed data from file</h2>
<div class="cell" data-editable="true" data-execution_count="19">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1"></a><span class="kw">def</span> read_file(filename<span class="op">=</span><span class="st">'sol.dat'</span>):</span>
<span id="cb22-2"><a href="#cb22-2"></a>    infile <span class="op">=</span> <span class="bu">open</span>(filename, <span class="st">'r'</span>)</span>
<span id="cb22-3"><a href="#cb22-3"></a>    u <span class="op">=</span> []<span class="op">;</span>  t <span class="op">=</span> []</span>
<span id="cb22-4"><a href="#cb22-4"></a>    <span class="cf">for</span> line <span class="kw">in</span> infile:</span>
<span id="cb22-5"><a href="#cb22-5"></a>        words <span class="op">=</span> line.split()</span>
<span id="cb22-6"><a href="#cb22-6"></a>        <span class="cf">if</span> <span class="bu">len</span>(words) <span class="op">!=</span> <span class="dv">2</span>:</span>
<span id="cb22-7"><a href="#cb22-7"></a>            <span class="bu">print</span> <span class="st">'Found more than two numbers on a line!'</span>, words</span>
<span id="cb22-8"><a href="#cb22-8"></a>            sys.exit(<span class="dv">1</span>)  <span class="co"># abort</span></span>
<span id="cb22-9"><a href="#cb22-9"></a>        t.append(<span class="bu">float</span>(words[<span class="dv">0</span>]))</span>
<span id="cb22-10"><a href="#cb22-10"></a>        u.append(<span class="bu">float</span>(words[<span class="dv">1</span>]))</span>
<span id="cb22-11"><a href="#cb22-11"></a>    <span class="cf">return</span> np.array(t), np.array(u)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Simpler code with <code>numpy</code> functionality for reading/writing tabular data:</p>
<div class="cell" data-editable="true" data-execution_count="20">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1"></a><span class="kw">def</span> read_file_numpy(filename<span class="op">=</span><span class="st">'sol.dat'</span>):</span>
<span id="cb23-2"><a href="#cb23-2"></a>    data <span class="op">=</span> np.loadtxt(filename)</span>
<span id="cb23-3"><a href="#cb23-3"></a>    t <span class="op">=</span> data[:,<span class="dv">0</span>]</span>
<span id="cb23-4"><a href="#cb23-4"></a>    u <span class="op">=</span> data[:,<span class="dv">1</span>]</span>
<span id="cb23-5"><a href="#cb23-5"></a>    <span class="cf">return</span> t, u</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Similar function <code>np.savetxt</code>, but then we need all <span class="math inline">\(u^n\)</span> and <span class="math inline">\(t^n\)</span> values in a two-dimensional array (which we try to prevent now!).</p>
</section>
<section id="usage-of-memory-saving-code" class="slide level2">
<h2>Usage of memory-saving code</h2>
<div class="cell" data-editable="true" data-execution_count="21">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1"></a><span class="kw">def</span> explore(I, a, T, dt, theta<span class="op">=</span><span class="fl">0.5</span>, makeplot<span class="op">=</span><span class="va">True</span>):</span>
<span id="cb24-2"><a href="#cb24-2"></a>    filename <span class="op">=</span> <span class="st">'u.dat'</span></span>
<span id="cb24-3"><a href="#cb24-3"></a>    u, t <span class="op">=</span> solver_memsave(I, a, T, dt, theta, filename)</span>
<span id="cb24-4"><a href="#cb24-4"></a></span>
<span id="cb24-5"><a href="#cb24-5"></a>    t, u <span class="op">=</span> read_file(filename)</span>
<span id="cb24-6"><a href="#cb24-6"></a>    u_e <span class="op">=</span> u_exact(t, I, a)</span>
<span id="cb24-7"><a href="#cb24-7"></a>    e <span class="op">=</span> u_e <span class="op">-</span> u</span>
<span id="cb24-8"><a href="#cb24-8"></a>    E <span class="op">=</span> np.sqrt(dt<span class="op">*</span>np.<span class="bu">sum</span>(e<span class="op">**</span><span class="dv">2</span>))</span>
<span id="cb24-9"><a href="#cb24-9"></a>    <span class="cf">if</span> makeplot:</span>
<span id="cb24-10"><a href="#cb24-10"></a>        plt.figure()</span>
<span id="cb24-11"><a href="#cb24-11"></a>        ...</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Complete program: <a href="http://tinyurl.com/ofkw6kc/alg/decay_memsave.py"><code>decay_memsave.py</code></a>.</p>
<div class="footer footer-default">

</div>
</section></section>
    </div>
  </div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="slides_alg_files/libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="slides_alg_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="slides_alg_files/libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="slides_alg_files/libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="slides_alg_files/libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="slides_alg_files/libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="slides_alg_files/libs/revealjs/plugin/notes/notes.js"></script>
  <script src="slides_alg_files/libs/revealjs/plugin/search/search.js"></script>
  <script src="slides_alg_files/libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="slides_alg_files/libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'smaller': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: false,

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const isCodeAnnotation = (el) => {
        for (const clz of el.classList) {
          if (clz.startsWith('code-annotation-')) {                     
            return true;
          }
        }
        return false;
      }
      const clipboard = new window.ClipboardJS('.code-copy-button', {
        text: function(trigger) {
          const codeEl = trigger.previousElementSibling.cloneNode(true);
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
        }
      });
      clipboard.on('success', function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Copied!");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      });
      function tippyHover(el, contentFn) {
        const config = {
          allowHTML: true,
          content: contentFn,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start'
        };
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          return note.innerHTML;
        });
      }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
    

</body></html>