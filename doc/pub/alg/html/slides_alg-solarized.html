<!--
File automatically generated using DocOnce (https://github.com/doconce/doconce/):
doconce format html slides_alg.do.txt --html_style=solarized3 --html_output=slides_alg-solarized --pygments_html_style=perldoc --pygments_html_linenos -DWITH_TOC
-->
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="DocOnce: https://github.com/doconce/doconce/" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta name="description" content="Study guide: Algorithms and implementations for exponential decay models">
<meta name="keywords" content="decay (problem),exponential decay,mesh,grid,mesh function,finite differences,difference equation,discrete equation,algebraic equation,finite difference scheme,Forward Euler scheme,backward scheme, 1-step,Backward Euler scheme,Crank-Nicolson scheme,weighted average,theta-rule,$\theta$-rule,finite difference operator notation,operator notation, finite differences">
<title>Study guide: Algorithms and implementations for exponential decay models</title>
<link href="https://raw.githubusercontent.com/doconce/doconce/main/bundled/html_styles/style_solarized_box/css/solarized_light_code.css" rel="stylesheet" type="text/css" title="light"/>
<script src="https://raw.githubusercontent.com/doconce/doconce/main/bundled/html_styles/style_solarized_box/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<link href="https://thomasf.github.io/solarized-css/solarized-light.min.css" rel="stylesheet">
<style type="text/css">
h1 {color: #b58900;}  /* yellow */
/* h1 {color: #cb4b16;}  orange */
/* h1 {color: #d33682;}  magenta, the original choice of thomasf */
code { padding: 0px; background-color: inherit; }
pre {
  border: 0pt solid #93a1a1;
  box-shadow: none;
}
.alert-text-small   { font-size: 80%;  }
.alert-text-large   { font-size: 130%; }
.alert-text-normal  { font-size: 90%;  }
.alert {
  padding:8px 35px 8px 14px; margin-bottom:18px;
  text-shadow:0 1px 0 rgba(255,255,255,0.5);
  border:1px solid #93a1a1;
  border-radius: 4px;
  -webkit-border-radius: 4px;
  -moz-border-radius: 4px;
  color: #555;
  background-color: #eee8d5;
  background-position: 10px 5px;
  background-repeat: no-repeat;
  background-size: 38px;
  padding-left: 55px;
  width: 75%;
 }
.alert-block {padding-top:14px; padding-bottom:14px}
.alert-block > p, .alert-block > ul {margin-bottom:1em}
.alert li {margin-top: 1em}
.alert-block p+p {margin-top:5px}
.alert-notice { background-image: url(https://raw.githubusercontent.com/doconce/doconce/bundled/html_images/small_yellow_notice.png); }
.alert-summary  { background-image:url(https://raw.githubusercontent.com/doconce/doconce/main/bundled/html_images/small_yellow_summary.png); }
.alert-warning { background-image: url(https://raw.githubusercontent.com/doconce/doconce/main/bundled/html_images/small_yellow_warning.png); }
.alert-question {background-image:url(https://raw.githubusercontent.com/doconce/doconce/main/bundled/html_images/small_yellow_question.png); }
div { text-align: justify; text-justify: inter-word; }
.tab {
  padding-left: 1.5em;
}
div.toc p,a {
  line-height: 1.3;
  margin-top: 1.1;
  margin-bottom: 1.1;
}
</style>
</head>

<!-- tocinfo
{'highest level': 1,
 'sections': [('Table of contents',
               1,
               'table_of_contents',
               'table_of_contents'),
              ('MAT-MEK4270 in a nutshell', 1, '42700:about', '42700:about'),
              ('The new official six-point course description',
               2,
               None,
               'the-new-official-six-point-course-description'),
              ('More specific contents: finite difference methods',
               2,
               None,
               'more-specific-contents-finite-difference-methods'),
              ('More specific contents: Variational methods (Galerkin)',
               2,
               None,
               'more-specific-contents-variational-methods-galerkin'),
              ('Philosophy: simplify, understand, generalize',
               2,
               None,
               'philosophy-simplify-understand-generalize'),
              ('Required software', 2, None, 'required-software'),
              ('Assumed/ideal background', 2, None, 'assumed-ideal-background'),
              ('Start-up example for the course',
               2,
               None,
               'start-up-example-for-the-course'),
              ('Start-up example', 2, None, 'start-up-example'),
              ('What to learn in the start-up example; standard topics',
               2,
               None,
               'what-to-learn-in-the-start-up-example-standard-topics'),
              ('What to learn in the start-up example; programming topics',
               2,
               None,
               'what-to-learn-in-the-start-up-example-programming-topics'),
              ('What to learn in the start-up example; mathematical analysis',
               2,
               None,
               'what-to-learn-in-the-start-up-example-mathematical-analysis'),
              ('Finite difference methods', 1, 'decay:fdm', 'decay:fdm'),
              ('Topics in the first intro to the finite difference method',
               2,
               None,
               'topics-in-the-first-intro-to-the-finite-difference-method'),
              ('A basic model for exponential decay',
               2,
               'decay:model',
               'decay:model'),
              ('The ODE model has a range of applications in many fields',
               2,
               None,
               'the-ode-model-has-a-range-of-applications-in-many-fields'),
              ('The ODE problem has a continuous and discrete version',
               2,
               None,
               'the-ode-problem-has-a-continuous-and-discrete-version'),
              ('Continuous problem', 3, None, 'continuous-problem'),
              ('Discrete problem', 3, None, 'discrete-problem'),
              ('The steps in the finite difference method',
               2,
               'decay:schemes:keysteps',
               'decay:schemes:keysteps'),
              ('Step 1: Discretizing the domain',
               2,
               None,
               'step-1-discretizing-the-domain'),
              ('Step 1: Discretizing the domain',
               2,
               None,
               'step-1-discretizing-the-domain'),
              ('What about a mesh function between the mesh points?',
               2,
               None,
               'what-about-a-mesh-function-between-the-mesh-points'),
              ('Step 2: Fulfilling the equation at discrete time points',
               2,
               None,
               'step-2-fulfilling-the-equation-at-discrete-time-points'),
              ('Step 3: Replacing derivatives by finite differences',
               2,
               None,
               'step-3-replacing-derivatives-by-finite-differences'),
              ('Step 3: Replacing derivatives by finite differences',
               2,
               None,
               'step-3-replacing-derivatives-by-finite-differences'),
              ('Step 4: Formulating a recursive algorithm',
               2,
               None,
               'step-4-formulating-a-recursive-algorithm'),
              ('Let us apply the scheme by hand',
               2,
               None,
               'let-us-apply-the-scheme-by-hand'),
              ('A backward difference', 2, None, 'a-backward-difference'),
              ('The Backward Euler scheme',
               2,
               None,
               'the-backward-euler-scheme'),
              ('A centered difference', 2, None, 'a-centered-difference'),
              ('The Crank-Nicolson scheme; ideas',
               2,
               'decay:schemes:CN',
               'decay:schemes:CN'),
              ('The Crank-Nicolson scheme; result',
               2,
               None,
               'the-crank-nicolson-scheme-result'),
              ('The unifying $\\theta$-rule',
               2,
               'decay:schemes:theta',
               'decay:schemes:theta'),
              ('Constant time step', 2, None, 'constant-time-step'),
              ('Test the understanding!', 2, None, 'test-the-understanding'),
              ('Compact operator notation for finite differences',
               2,
               'decay:fd:op',
               'decay:fd:op'),
              ('Specific notation for difference operators',
               2,
               None,
               'specific-notation-for-difference-operators'),
              ('The Backward Euler scheme with operator notation',
               2,
               None,
               'the-backward-euler-scheme-with-operator-notation'),
              ('The Forward Euler scheme with operator notation',
               2,
               None,
               'the-forward-euler-scheme-with-operator-notation'),
              ('The Crank-Nicolson scheme with operator notation',
               2,
               None,
               'the-crank-nicolson-scheme-with-operator-notation'),
              ('Implementation', 1, 'decay:impl1', 'decay:impl1'),
              ('Requirements of a program',
               2,
               None,
               'requirements-of-a-program'),
              ('Tools to learn', 2, None, 'tools-to-learn'),
              ('Why implement in Python?', 2, None, 'why-implement-in-python'),
              ('Why implement in Python?', 2, None, 'why-implement-in-python'),
              ('Algorithm', 2, 'decay:py1', 'decay:py1'),
              ('Translation to Python function',
               2,
               None,
               'translation-to-python-function'),
              ('Integer division', 2, None, 'integer-division'),
              ('Doc strings', 2, None, 'doc-strings'),
              ('Formatting of numbers', 2, None, 'formatting-of-numbers'),
              ('Running the program', 2, None, 'running-the-program'),
              ('Plotting the solution', 2, None, 'plotting-the-solution'),
              ('Comparing with the exact solution',
               2,
               None,
               'comparing-with-the-exact-solution'),
              ('Add legends, axes labels, title, and wrap in a function',
               2,
               None,
               'add-legends-axes-labels-title-and-wrap-in-a-function'),
              ('Verifying the implementation',
               1,
               'decay:verification',
               'decay:verification'),
              ('Simplest method: run a few algorithmic steps by hand',
               2,
               None,
               'simplest-method-run-a-few-algorithmic-steps-by-hand'),
              ('Comparison with an exact discrete solution',
               2,
               None,
               'comparison-with-an-exact-discrete-solution'),
              ('Making a test based on an exact discrete solution',
               2,
               None,
               'making-a-test-based-on-an-exact-discrete-solution'),
              ('Computing the numerical error as a mesh function',
               2,
               'decay:computing:error',
               'decay:computing:error'),
              ('Computing the norm of the error',
               2,
               'decay:computing:error:norm',
               'decay:computing:error:norm'),
              ('Norms of mesh functions', 2, None, 'norms-of-mesh-functions'),
              ('Norms - notice!', 2, None, 'norms-notice'),
              ('Implementation of the norm of the error',
               2,
               None,
               'implementation-of-the-norm-of-the-error'),
              ('Comment on array vs scalar computation',
               2,
               None,
               'comment-on-array-vs-scalar-computation')]}
end of tocinfo -->

<body>



<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: {
     equationNumbers: {  autoNumber: "AMS"  },
     extensions: ["AMSmath.js", "AMSsymbols.js", "autobold.js", "color.js"]
  }
});
</script>
<script type="text/javascript" async
 src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>

<!-- newcommands_keep.tex -->
$$
\newcommand{\half}{\frac{1}{2}}
\newcommand{\uex}{{u_{\small\mbox{e}}}}
$$



<!-- ------------------- main content ---------------------- -->
<center>
<h1>Study guide: Algorithms and implementations for exponential decay models</h1>
</center>  <!-- document title -->

<!-- author(s): Hans Petter Langtangen -->
<center>
<b>Hans Petter Langtangen</b> [1, 2]
</center>
<!-- institution(s) -->
<center>
[1] <b>Center for Biomedical Computing, Simula Research Laboratory</b>
</center>
<center>
[2] <b>Department of Informatics, University of Oslo</b>
</center>
<br>
<center>
<h4>Aug 16, 2023</h4>
</center> <!-- date -->
<br>

<center>  <!-- FIGURE -->
<hr class="figure">
<center>
<p class="caption">Figure 1</p>
</center>
<p><img src="mik.png" ></p>
</center>

<!-- !split --><br><br><br><br><br><br><br><br>
<h1 id="table_of_contents">Table of contents</h1>

<div class='toc'>
<p><a href="#42700:about"> MAT-MEK4270 in a nutshell </a></p>
<p><span class="tab"> <a href="#the-new-official-six-point-course-description"> The new official six-point course description </a></p>
<p><span class="tab"> <a href="#more-specific-contents-finite-difference-methods"> More specific contents: finite difference methods </a></p>
<p><span class="tab"> <a href="#more-specific-contents-variational-methods-galerkin"> More specific contents: Variational methods (Galerkin) </a></p>
<p><span class="tab"> <a href="#philosophy-simplify-understand-generalize"> Philosophy: simplify, understand, generalize </a></p>
<p><span class="tab"> <a href="#required-software"> Required software </a></p>
<p><span class="tab"> <a href="#assumed-ideal-background"> Assumed/ideal background </a></p>
<p><span class="tab"> <a href="#start-up-example-for-the-course"> Start-up example for the course </a></p>
<p><span class="tab"> <a href="#start-up-example"> Start-up example </a></p>
<p><span class="tab"> <a href="#what-to-learn-in-the-start-up-example-standard-topics"> What to learn in the start-up example; standard topics </a></p>
<p><span class="tab"> <a href="#what-to-learn-in-the-start-up-example-programming-topics"> What to learn in the start-up example; programming topics </a></p>
<p><span class="tab"> <a href="#what-to-learn-in-the-start-up-example-mathematical-analysis"> What to learn in the start-up example; mathematical analysis </a></p>
<p><a href="#decay:fdm"> Finite difference methods  </a></p>
<p><span class="tab"> <a href="#topics-in-the-first-intro-to-the-finite-difference-method"> Topics in the first intro to the finite difference method </a></p>
<p><span class="tab"> <a href="#decay:model"> A basic model for exponential decay </a></p>
<p><span class="tab"> <a href="#the-ode-model-has-a-range-of-applications-in-many-fields"> The ODE model has a range of applications in many fields </a></p>
<p><span class="tab"> <a href="#the-ode-problem-has-a-continuous-and-discrete-version"> The ODE problem has a continuous and discrete version </a></p>
<p><span class="tab"> <a href="#decay:schemes:keysteps"> The steps in the finite difference method </a></p>
<p><span class="tab"> <a href="#step-1-discretizing-the-domain"> Step 1: Discretizing the domain </a></p>
<p><span class="tab"> <a href="#step-1-discretizing-the-domain"> Step 1: Discretizing the domain </a></p>
<p><span class="tab"> <a href="#what-about-a-mesh-function-between-the-mesh-points"> What about a mesh function between the mesh points? </a></p>
<p><span class="tab"> <a href="#step-2-fulfilling-the-equation-at-discrete-time-points"> Step 2: Fulfilling the equation at discrete time points </a></p>
<p><span class="tab"> <a href="#step-3-replacing-derivatives-by-finite-differences"> Step 3: Replacing derivatives by finite differences </a></p>
<p><span class="tab"> <a href="#step-3-replacing-derivatives-by-finite-differences"> Step 3: Replacing derivatives by finite differences </a></p>
<p><span class="tab"> <a href="#step-4-formulating-a-recursive-algorithm"> Step 4: Formulating a recursive algorithm </a></p>
<p><span class="tab"> <a href="#let-us-apply-the-scheme-by-hand"> Let us apply the scheme by hand </a></p>
<p><span class="tab"> <a href="#a-backward-difference"> A backward difference </a></p>
<p><span class="tab"> <a href="#the-backward-euler-scheme"> The Backward Euler scheme </a></p>
<p><span class="tab"> <a href="#a-centered-difference"> A centered difference </a></p>
<p><span class="tab"> <a href="#decay:schemes:CN"> The Crank-Nicolson scheme; ideas </a></p>
<p><span class="tab"> <a href="#the-crank-nicolson-scheme-result"> The Crank-Nicolson scheme; result </a></p>
<p><span class="tab"> <a href="#decay:schemes:theta"> The unifying \( \theta \)-rule </a></p>
<p><span class="tab"> <a href="#constant-time-step"> Constant time step </a></p>
<p><span class="tab"> <a href="#test-the-understanding"> Test the understanding! </a></p>
<p><span class="tab"> <a href="#decay:fd:op"> Compact operator notation for finite differences </a></p>
<p><span class="tab"> <a href="#specific-notation-for-difference-operators"> Specific notation for difference operators </a></p>
<p><span class="tab"> <a href="#the-backward-euler-scheme-with-operator-notation"> The Backward Euler scheme with operator notation </a></p>
<p><span class="tab"> <a href="#the-forward-euler-scheme-with-operator-notation"> The Forward Euler scheme with operator notation </a></p>
<p><span class="tab"> <a href="#the-crank-nicolson-scheme-with-operator-notation"> The Crank-Nicolson scheme with operator notation </a></p>
<p><a href="#decay:impl1"> Implementation </a></p>
<p><span class="tab"> <a href="#requirements-of-a-program"> Requirements of a program </a></p>
<p><span class="tab"> <a href="#tools-to-learn"> Tools to learn </a></p>
<p><span class="tab"> <a href="#why-implement-in-python"> Why implement in Python? </a></p>
<p><span class="tab"> <a href="#why-implement-in-python"> Why implement in Python? </a></p>
<p><span class="tab"> <a href="#decay:py1"> Algorithm </a></p>
<p><span class="tab"> <a href="#translation-to-python-function"> Translation to Python function </a></p>
<p><span class="tab"> <a href="#integer-division"> Integer division </a></p>
<p><span class="tab"> <a href="#doc-strings"> Doc strings </a></p>
<p><span class="tab"> <a href="#formatting-of-numbers"> Formatting of numbers </a></p>
<p><span class="tab"> <a href="#running-the-program"> Running the program </a></p>
<p><span class="tab"> <a href="#plotting-the-solution"> Plotting the solution </a></p>
<p><span class="tab"> <a href="#comparing-with-the-exact-solution"> Comparing with the exact solution </a></p>
<p><span class="tab"> <a href="#add-legends-axes-labels-title-and-wrap-in-a-function"> Add legends, axes labels, title, and wrap in a function </a></p>
<p><a href="#decay:verification"> Verifying the implementation </a></p>
<p><span class="tab"> <a href="#simplest-method-run-a-few-algorithmic-steps-by-hand"> Simplest method: run a few algorithmic steps by hand </a></p>
<p><span class="tab"> <a href="#comparison-with-an-exact-discrete-solution"> Comparison with an exact discrete solution </a></p>
<p><span class="tab"> <a href="#making-a-test-based-on-an-exact-discrete-solution"> Making a test based on an exact discrete solution </a></p>
<p><span class="tab"> <a href="#decay:computing:error"> Computing the numerical error as a mesh function </a></p>
<p><span class="tab"> <a href="#decay:computing:error:norm"> Computing the norm of the error </a></p>
<p><span class="tab"> <a href="#norms-of-mesh-functions"> Norms of mesh functions </a></p>
<p><span class="tab"> <a href="#norms-notice"> Norms - notice! </a></p>
<p><span class="tab"> <a href="#implementation-of-the-norm-of-the-error"> Implementation of the norm of the error </a></p>
<p><span class="tab"> <a href="#comment-on-array-vs-scalar-computation"> Comment on array vs scalar computation </a></p>
</div>
<br>

<!-- !split --><br><br><br><br><br><br><br><br>
<h1 id="42700:about">MAT-MEK4270 in a nutshell</h1>

<ul>
 <p><li> Numerical methods for partial differential equations (PDEs)</li>
 <p><li> How do we solve a PDE in practice and produce numbers?</li>
 <p><li> How do we trust the answer?</li>
 <p><li> Approach: <em>simplify, understand, generalize</em></li>
 <p><li> IN5670 -> IN5270 -> MAT-MEK4270 - Lots of old material</li>
</ul>
<div class="alert alert-block alert-summary alert-text-normal">
<b>After the course</b>
<p>
<p>You see a PDE and can't wait to program a method
and visualize a solution! Somebody asks if the solution is right
and you can give a convincing answer.
</p>
</div>


<!-- !split --><br><br><br><br><br><br><br><br>
<h2 id="the-new-official-six-point-course-description">The new official six-point course description </h2>

<p>After having completed MAT-MEK4270 you</p>

<ul>
 <p><li> can derive methods and implement them to solve frequently arising partial differential equations (PDEs) from physics and mechanics.</li>
 <p><li> have a good understanding of finite difference and finite element methods and how they are applied in linear and nonlinear PDE problems.</li>
 <p><li> can identify numerical artifacts and perform mathematical analysis to understand and cure non-physical effects.</li>
 <p><li> can apply sophisticated programming techniques in Python, combined with Cython, C, C++, and Fortran code, to create modern, flexible simulation programs.</li>
 <p><li> can construct verification tests and automate them.</li>
 <p><li> have experience with project hosting sites (GitHub), version control systems (Git), report writing (LaTeX), and Python scripting for performing reproducible computational science.</li>
</ul>
<!-- !split --><br><br><br><br><br><br><br><br>
<h2 id="more-specific-contents-finite-difference-methods">More specific contents: finite difference methods </h2>

<div class="alert alert-block alert-block alert-text-normal">
<b></b>
<p>
<ul>
   <p><li> Simple ODEs</li>
   <p><li> Exponential decay \( u_t = -a u(t) \) in time</li>
   <p><li> the wave equation \( u_{tt}=\nabla^2 u \) in 1D, 2D, 3D</li>
   <p><li> write your own software from scratch</li>
   <p><li> understand how the methods work and why they fail</li>
</ul>
</div>


<!-- !split --><br><br><br><br><br><br><br><br>
<h2 id="more-specific-contents-variational-methods-galerkin">More specific contents: Variational methods (Galerkin) </h2>

<div class="alert alert-block alert-block alert-text-normal">
<b></b>
<p>
<ul>
   <p><li> stationary diffusion equations \( u_{xx}=f \) in 1D</li>
   <p><li> time-dependent diffusion and wave equations in 1D</li>
   <p><li> PDEs in 2D and 3D by use of the FEniCS and Shenfun softwares</li>
   <p><li> perform hand-calculations, write your own software (1D)</li>
   <p><li> understand how the methods work and why they fail</li>
</ul>
</div>


<!-- !split --><br><br><br><br><br><br><br><br>
<h2 id="philosophy-simplify-understand-generalize">Philosophy: simplify, understand, generalize </h2>

<ul>
 <p><li> Start with simplified ODE/PDE problems</li>
 <p><li> Learn to reason about the discretization</li>
 <p><li> Learn to implement, verify, and experiment</li>
 <p><li> Understand the method, program, and results</li>
 <p><li> Generalize the problem, method, and program</li>
</ul>
<p>This is the power of applied mathematics!</p>

<!-- !split --><br><br><br><br><br><br><br><br>
<h2 id="required-software">Required software </h2>

<ul>
 <p><li> Our software platform: Python (sometimes combined with Cython, Fortran, C, C++)</li>
 <p><li> Important Python packages: <code>numpy</code>, <code>scipy</code>, <code>matplotlib</code>, <code>sympy</code>, <code>fenics</code>, <code>shenfun</code>, ...</li>
 <p><li> Anaconda Python</li>
</ul>
<!-- !split --><br><br><br><br><br><br><br><br>
<h2 id="assumed-ideal-background">Assumed/ideal background </h2>

<ul>
 <p><li> IN1900: Python programming, solution of ODEs</li>
 <p><li> Some experience with finite difference methods</li>
 <p><li> Some analytical and numerical knowledge of PDEs</li>
 <p><li> Much experience with calculus and linear algebra</li>
 <p><li> Much experience with programming of mathematical problems</li>
 <p><li> Experience with mathematical modeling with PDEs (from physics, mechanics, geophysics, or ...)</li>
</ul>
<!-- !split --><br><br><br><br><br><br><br><br>
<h2 id="start-up-example-for-the-course">Start-up example for the course </h2>

<p>What if you don't have this ideal background?</p>

<ul>
 <p><li> Students come to this course with very different backgrounds</li>
 <p><li> First task: summarize assumed background knowledge by going through a simple example</li>
 <p><li> Also in this example:</li>
<ul>
   <p><li> Some fundamental material on software implementation and software testing</li>
   <p><li> Material on analyzing numerical methods to understand why they can fail</li>
   <p><li> Applications to real-world problems</li>
</ul>
</ul>
<!-- !split --><br><br><br><br><br><br><br><br>
<h2 id="start-up-example">Start-up example </h2>

<div class="alert alert-block alert-notice alert-text-normal">
<b>ODE problem</b>
<p>
$$ u'=-au,\quad u(0)=I,\ t\in (0,T],$$

<p>where \( a>0 \) is a constant.</p>
</div>


<p>Everything we do is motivated by what we need as building blocks for
solving Partial Differential Equations (PDEs)!
</p>

<!-- !split --><br><br><br><br><br><br><br><br>
<h2 id="what-to-learn-in-the-start-up-example-standard-topics">What to learn in the start-up example; standard topics </h2>

<ul>
 <p><li> How to think when constructing finite difference methods, with special focus on the Forward Euler, Backward Euler, and Crank-Nicolson (midpoint) schemes</li>
 <p><li> How to formulate a computational algorithm and translate it into Python code</li>
 <p><li> How to make curve plots of the solutions</li>
 <p><li> How to compute numerical errors</li>
 <p><li> How to compute convergence rates</li>
</ul>
<!-- !split --><br><br><br><br><br><br><br><br>
<h2 id="what-to-learn-in-the-start-up-example-programming-topics">What to learn in the start-up example; programming topics </h2>

<ul>
 <p><li> How to verify an implementation and automate verification through nose tests in Python</li>
 <p><li> How to structure code in terms of functions, classes, and modules</li>
 <p><li> How to work with Python concepts such as arrays, lists, dictionaries, lambda functions, functions in functions (closures), doctests, unit tests, command-line interfaces, graphical user interfaces</li>
 <p><li> How to perform array computing and understand the difference from scalar computing</li>
 <p><li> How to conduct and automate large-scale numerical experiments</li>
 <p><li> How to generate scientific reports</li>
</ul>
<!-- !split --><br><br><br><br><br><br><br><br>
<h2 id="what-to-learn-in-the-start-up-example-mathematical-analysis">What to learn in the start-up example; mathematical analysis </h2>

<ul>
 <p><li> How to uncover numerical artifacts in the computed solution</li>
 <p><li> How to analyze the numerical schemes mathematically to understand why artifacts occur</li>
 <p><li> How to derive mathematical expressions for various measures of the error in numerical methods, frequently by using the <code>sympy</code> software for symbolic computation</li>
 <p><li> Introduce concepts such as finite difference operators, mesh (grid), mesh functions, stability, truncation error, consistency, and convergence</li>
</ul>
<!-- !split --><br><br><br><br><br><br><br><br>
<h1 id="decay:fdm">Finite difference methods</h1>

<ul>
 <p><li> The finite difference method is the simplest method for solving differential equations</li>
 <p><li> Fast to learn, derive, and implement</li>
 <p><li> A very useful tool to know, even if you aim at using the finite element or the finite volume method</li>
</ul>
<center>  <!-- FIGURE -->
<hr class="figure">
<center>
<p class="caption">Figure 2</p>
</center>
<p><img src="fig-alg/fdm_u_uei.png" width="400" align="bottom"></p>
</center>

<!-- !split --><br><br><br><br><br><br><br><br>
<h2 id="topics-in-the-first-intro-to-the-finite-difference-method">Topics in the first intro to the finite difference method </h2>

<div class="alert alert-block alert-notice alert-text-normal">
<b>Contents</b>
<p>
<ul>
 <p><li> How to think about finite difference discretization</li>
 <p><li> Key concepts:</li>
<ul>
   <p><li> mesh</li>
   <p><li> mesh function</li>
   <p><li> finite difference approximations</li>
</ul>
 <p><li> The Forward Euler, Backward Euler, and Crank-Nicolson methods</li>
 <p><li> Finite difference operator notation</li>
 <p><li> How to derive an algorithm and implement it in Python</li>
 <p><li> How to test the implementation</li>
</ul>
</div>


<!-- !split --><br><br><br><br><br><br><br><br>
<h2 id="decay:model">A basic model for exponential decay</h2>

<p>The world's simplest (?) ODE:</p>

$$
\begin{equation*}
u'(t) = -au(t),\quad u(0)=I,\ t\in (0,T]
\end{equation*}
$$


<div class="alert alert-block alert-notice alert-text-normal">
<b>Observation</b>
<p>
<p>We can learn a lot about numerical methods, computer implementation,
program testing, and real applications of these tools by using
this very simple ODE as example. The teaching principle is to keep the math as
simple as possible while learning computer tools.
</p>
</div>


<center>  <!-- FIGURE -->
<hr class="figure">
<center>
<p class="caption">Figure 3</p>
</center>
<p><img src="fig-alg/FE1.png" width="600" align="bottom"></p>
</center>

<!-- !split --><br><br><br><br><br><br><br><br>
<h2 id="the-ode-model-has-a-range-of-applications-in-many-fields">The ODE model has a range of applications in many fields </h2>

<ul>
 <p><li> Growth and decay of populations (cells, animals, human)</li>
 <p><li> Growth and decay of a fortune</li>
 <p><li> Radioactive decay</li>
 <p><li> Cooling/heating of an object</li>
 <p><li> Pressure variation in the atmosphere</li>
 <p><li> Vertical motion of a body in water/air</li>
 <p><li> Time-discretization of diffusion PDEs by Fourier techniques</li>
</ul>
<p>See the <a href="https://link.springer.com/chapter/10.1007/978-3-319-29439-1_1" target="_self">text</a> for details.</p>

<!-- !split --><br><br><br><br><br><br><br><br>
<h2 id="the-ode-problem-has-a-continuous-and-discrete-version">The ODE problem has a continuous and discrete version </h2>
<h3 id="continuous-problem">Continuous problem </h3>

$$
\begin{equation}
u' = -au,\ t\in (0,T], \quad u(0)=I
\label{decay:problem}
\end{equation}
$$

<p>(varies with a continuous \( t \))</p>
<h3 id="discrete-problem">Discrete problem </h3>

<p>Numerical methods applied to the continuous problem turns it into
a discrete problem
</p>

$$
\begin{equation}
u^{n+1} = \mbox{const} \cdot u^n, \quad n=0,1,\ldots N_t-1, \quad u^n=I
\label{decay:problem:discrete}
\end{equation}
$$

<p>(varies with discrete mesh points \( t_n \))</p>

<!-- !split --><br><br><br><br><br><br><br><br>
<h2 id="decay:schemes:keysteps">The steps in the finite difference method</h2>

<p>Solving a differential equation by a finite difference method
consists of four steps:
</p>

<ol>
<p><li> discretizing the domain,</li>
<p><li> fulfilling the equation at discrete time points,</li>
<p><li> replacing derivatives by finite differences,</li>
<p><li> solve the discretized problem. (Often with a recursive algorithm in 1D)</li>
</ol>
<!-- !split --><br><br><br><br><br><br><br><br>
<h2 id="step-1-discretizing-the-domain">Step 1: Discretizing the domain </h2>

<p>The time domain \( [0,T] \) is represented by a <em>mesh</em>: a finite number of
\( N_t+1 \) points
</p>

$$0 = t_0 < t_1 < t_2 < \cdots < t_{N_t-1} < t_{N_t} = T$$


<ul>
 <p><li> We seek the solution \( u \) at the mesh points: \( u(t_n) \), \( n=1,2,\ldots,N_t \).</li>
 <p><li> Note: \( u^0 \) is known as \( I \).</li>
 <p><li> Notational short-form for the numerical approximation to \( u(t_n) \): \( u^n \)</li>
 <p><li> In the differential equation: \( u \) is the exact solution</li>
 <p><li> In the numerical method and implementation: \( u^n \) is the numerical approximation, \( \uex(t) \) is the exact solution</li>
</ul>
<!-- !split --><br><br><br><br><br><br><br><br>
<h2 id="step-1-discretizing-the-domain">Step 1: Discretizing the domain </h2>

<p>\( u^n \) is a mesh function, defined at the mesh points \( t_n \), \( n=0,\ldots,N_t \)
only.
</p>

<center>  <!-- FIGURE -->
<hr class="figure">
<center>
<p class="caption">Figure 4</p>
</center>
<p><img src="fig-alg/fdm_u_ue.png" width="600" align="bottom"></p>
</center>

<!-- !split --><br><br><br><br><br><br><br><br>
<h2 id="what-about-a-mesh-function-between-the-mesh-points">What about a mesh function between the mesh points? </h2>

<p>Can extend the mesh function to yield values between mesh points
by <em>linear interpolation</em>:
</p>

$$
\begin{equation}
u(t) \approx u^n + \frac{u^{n+1}-u^n}{t_{n+1}-t_n}(t - t_n)
\label{_auto1}
\end{equation}
$$


<center>  <!-- FIGURE -->
<hr class="figure">
<center>
<p class="caption">Figure 5</p>
</center>
<p><img src="fig-alg/fdm_u_uei.png" width="500" align="bottom"></p>
</center>

<!-- !split --><br><br><br><br><br><br><br><br>
<h2 id="step-2-fulfilling-the-equation-at-discrete-time-points">Step 2: Fulfilling the equation at discrete time points </h2>

<ul>
 <p><li> The ODE holds for all \( t\in (0,T] \) (infinite no of points)</li>
 <p><li> Idea: let the ODE be valid at the mesh points only (finite no of points)</li>
</ul>
$$
\begin{equation}
u'(t_n) = -au(t_n),\quad n=1,\ldots,N_t
\label{decay:step2}
\end{equation}
$$


<!-- !split --><br><br><br><br><br><br><br><br>
<h2 id="step-3-replacing-derivatives-by-finite-differences">Step 3: Replacing derivatives by finite differences </h2>

<p>Now it is time for the <em>finite difference</em> approximations of
derivatives:
</p>

$$
\begin{equation}
u'(t_n) \approx \frac{u^{n+1}-u^{n}}{t_{n+1}-t_n}
\label{decay:FEdiff}
\end{equation}
$$


<center>  <!-- FIGURE -->
<hr class="figure">
<center>
<p class="caption">Figure 6</p>
</center>
<p><img src="fig-alg/fd_forward.png" width="400" align="bottom"></p>
</center>

<!-- !split --><br><br><br><br><br><br><br><br>
<h2 id="step-3-replacing-derivatives-by-finite-differences">Step 3: Replacing derivatives by finite differences </h2>

<p>Inserting the finite difference approximation in</p>

$$ u'(t_n) = -au(t_n)$$

<p>gives</p>

$$
\begin{equation}
\frac{u^{n+1}-u^{n}}{t_{n+1}-t_n} = -au^{n},\quad n=0,1,\ldots,N_t-1
\label{decay:step3}
\end{equation}
$$

<p>(Known as <em>discrete equation</em>, or <em>discrete problem</em>,
or <em>finite difference method/scheme</em>)
</p>

<!-- !split --><br><br><br><br><br><br><br><br>
<h2 id="step-4-formulating-a-recursive-algorithm">Step 4: Formulating a recursive algorithm </h2>

<p>How can we actually compute the \( u^n \) values?</p>

<ul>
  <p><li> given \( u^0=I \)</li>
  <p><li> compute \( u^1 \) from \( u^0 \)</li>
  <p><li> compute \( u^2 \) from \( u^1 \)</li>
  <p><li> compute \( u^3 \) from \( u^2 \) (and so forth)</li>
</ul>
<p>In general: we have \( u^n \) and seek \( u^{n+1} \)</p>

<div class="alert alert-block alert-notice alert-text-normal">
<b>The Forward Euler scheme</b>
<p>
<p>Solve wrt \( u^{n+1} \) to get the computational formula:</p>

$$
\begin{equation}
u^{n+1} = u^n - a(t_{n+1} -t_n)u^n
\label{decay:FE}
\end{equation}
$$
</div>


<!-- !split --><br><br><br><br><br><br><br><br>
<h2 id="let-us-apply-the-scheme-by-hand">Let us apply the scheme by hand </h2>

<p>Assume constant time spacing: \( \Delta t = t_{n+1}-t_n=\mbox{const} \)</p>

$$
\begin{align*}
u_0 &= I,\\ 
u_1 & = u^0 - a\Delta t u^0 = I(1-a\Delta t),\\ 
u_2 & = I(1-a\Delta t)^2,\\ 
u^3 &= I(1-a\Delta t)^3,\\ 
&\vdots\\ 
u^{N_t} &= I(1-a\Delta t)^{N_t}
\end{align*}
$$

<p>Ooops - we can find the numerical solution by hand (in this simple
example)! No need for a computer (yet)...
</p>

<!-- !split --><br><br><br><br><br><br><br><br>
<h2 id="a-backward-difference">A backward difference </h2>

<p>Here is another finite difference approximation to the
derivative (backward difference):
</p>

$$
\begin{equation}
u'(t_n) \approx \frac{u^{n}-u^{n-1}}{t_{n}-t_{n-1}}
\label{decay:BEdiff}
\end{equation}
$$


<center>  <!-- FIGURE -->
<hr class="figure">
<center>
<p class="caption">Figure 7</p>
</center>
<p><img src="fig-alg/fd_backward.png" width="400" align="bottom"></p>
</center>

<!-- !split --><br><br><br><br><br><br><br><br>
<h2 id="the-backward-euler-scheme">The Backward Euler scheme </h2>

<p>Inserting the finite difference approximation in \( u'(t_n)=-au(t_n) \) yields
the Backward Euler (BE) scheme:
</p>

$$
\begin{equation}
\frac{u^{n}-u^{n-1}}{t_{n}-t_{n-1}} = -a u^n
\label{decay:BE0}
\end{equation}
$$

<p>Solve with respect to the unknown \( u^{n+1} \):</p>

$$
\begin{equation}
u^{n+1} = \frac{1}{1+ a(t_{n+1}-t_n)} u^n
\label{decay:BE}
\end{equation}
$$


<!-- !split --><br><br><br><br><br><br><br><br>
<h2 id="a-centered-difference">A centered difference </h2>

<p>Centered differences are better approximations than forward or
backward differences.
</p>

<center>  <!-- FIGURE -->
<hr class="figure">
<center>
<p class="caption">Figure 8</p>
</center>
<p><img src="fig-alg/fd_centered_CN.png" width="400" align="bottom"></p>
</center>

<!-- !split --><br><br><br><br><br><br><br><br>
<h2 id="decay:schemes:CN">The Crank-Nicolson scheme; ideas</h2>

<p>Idea 1: let the ODE hold at \( t_{n+\half} \)</p>

$$ u'(t_{n+\half}) = -au(t_{n+\half})$$

<p>Idea 2: approximate \( u'(t_{n+\half}) \) by a centered difference</p>

$$
\begin{equation}
u'(t_{n+\half}) \approx \frac{u^{n+1}-u^n}{t_{n+1}-t_n}
\label{decay:CNdiff}
\end{equation}
$$

<p>Problem: \( u(t_{n+\half}) \) is not defined, only \( u^n=u(t_n) \) and \( u^{n+1}=u(t_{n+1}) \)</p>

<p>Solution:</p>

$$ u(t_{n+\half}) \approx \half(u^n + u^{n+1}) $$


<!-- !split --><br><br><br><br><br><br><br><br>
<h2 id="the-crank-nicolson-scheme-result">The Crank-Nicolson scheme; result </h2>

<p>Result:</p>

$$
\begin{equation}
\frac{u^{n+1}-u^n}{t_{n+1}-t_n} = -a\half (u^n + u^{n+1})
\label{decay:CN1}
\end{equation}
$$

<p>Solve wrt to \( u^{n+1} \):</p>

$$
\begin{equation}
u^{n+1} = \frac{1-\half a(t_{n+1}-t_n)}{1 + \half a(t_{n+1}-t_n)}u^n
\label{decay:CN}
\end{equation}
$$

<p>This is a Crank-Nicolson (CN) scheme or a midpoint or centered scheme.</p>

<!-- !split --><br><br><br><br><br><br><br><br>
<h2 id="decay:schemes:theta">The unifying \( \theta \)-rule</h2>

<p>The Forward Euler, Backward Euler, and Crank-Nicolson schemes can be
formulated as one scheme with a varying parameter \( \theta \):
</p>

$$
\begin{equation}
\frac{u^{n+1}-u^{n}}{t_{n+1}-t_n} = -a (\theta u^{n+1} + (1-\theta) u^{n})
\label{decay:th0}
\end{equation}
$$


<ul>
 <p><li> \( \theta =0 \): Forward Euler</li>
 <p><li> \( \theta =1 \): Backward Euler</li>
 <p><li> \( \theta =1/2 \): Crank-Nicolson</li>
 <p><li> We may alternatively choose any \( \theta\in [0,1] \).</li>
</ul>
<p>\( u^n \) is known, solve for \( u^{n+1} \):</p>

$$
\begin{equation}
u^{n+1} = \frac{1 - (1-\theta) a(t_{n+1}-t_n)}{1 + \theta a(t_{n+1}-t_n)} u^n
\label{decay:th}
\end{equation}
$$


<!-- !split --><br><br><br><br><br><br><br><br>
<h2 id="constant-time-step">Constant time step </h2>

<p>Very common assumption (not important, but exclusively used for
simplicity hereafter): constant time step \( t_{n+1}-t_n\equiv\Delta t \)
</p>

<div class="alert alert-block alert-summary alert-text-normal">
<b>Summary of schemes for constant time step</b>
<p>
$$
\begin{align}
u^{n+1} &= (1 - a\Delta t )u^n  \quad (\hbox{FE})
\label{decay:FE:u}\\ 
u^{n+1} &= \frac{1}{1+ a\Delta t} u^n  \quad (\hbox{BE})
\label{decay:BE:u}\\ 
u^{n+1} &= \frac{1-\half a\Delta t}{1 + \half a\Delta t} u^n \quad (\hbox{CN})
\label{decay:CN:u}\\ 
u^{n+1} &= \frac{1 - (1-\theta) a\Delta t}{1 + \theta a\Delta t}u^n \quad (\theta-\hbox{rule})
\label{decay:th:u}
\end{align}
$$
</div>


<!-- !split --><br><br><br><br><br><br><br><br>
<h2 id="test-the-understanding">Test the understanding! </h2>

<p>Derive Forward Euler, Backward Euler, and Crank-Nicolson schemes for
Newton's law of cooling:
</p>

$$ T' = -k(T-T_s),\quad T(0)=T_0,\ t\in (0,t_{\mbox{end}}]$$

<p>Physical quantities:</p>

<ul>
 <p><li> \( T(t) \): temperature of an object at time \( t \)</li>
 <p><li> \( k \): parameter expressing heat loss to the surroundings</li>
 <p><li> \( T_s \): temperature of the surroundings</li>
 <p><li> \( T_0 \): initial temperature</li>
</ul>
<!-- !split --><br><br><br><br><br><br><br><br>
<h2 id="decay:fd:op">Compact operator notation for finite differences</h2>

<ul>
 <p><li> Finite difference formulas can be tedious to write and read/understand</li>
 <p><li> Handy tool: finite difference operator notation</li>
 <p><li> Advantage: communicates the nature of the difference in a compact way</li>
</ul>
$$
\begin{equation}
[D_t^- u  = -au]^n
\label{_auto2}
\end{equation}
$$


<!-- !split --><br><br><br><br><br><br><br><br>
<h2 id="specific-notation-for-difference-operators">Specific notation for difference operators </h2>

<p>Forward difference:</p>

$$
\begin{equation}
[D_t^+u]^n = \frac{u^{n+1} - u^{n}}{\Delta t}
\approx \frac{d}{dt} u(t_n) \label{fd:D:f}
\end{equation}
$$

<p>Centered difference (around \( t_n \)):</p>

$$
\begin{equation}
[D_tu]^n = \frac{u^{n+\half} - u^{n-\half}}{\Delta t}
\approx \frac{d}{dt} u(t_n), \label{fd:D:c}
\end{equation}
$$

<p>Backward difference:</p>
$$
\begin{equation}
[D_t^-u]^n = \frac{u^{n} - u^{n-1}}{\Delta t}
\approx \frac{d}{dt} u(t_n) \label{fd:D:b}
\end{equation}
$$


<!-- !split --><br><br><br><br><br><br><br><br>
<h2 id="the-backward-euler-scheme-with-operator-notation">The Backward Euler scheme with operator notation </h2>

$$
\begin{equation*}
[D_t^-u]^n = -au^n
\end{equation*}
$$

<p>Common to put the whole equation inside square brackets:</p>

$$
\begin{equation}
[D_t^- u  = -au]^n
\label{_auto3}
\end{equation}
$$


<!-- !split --><br><br><br><br><br><br><br><br>
<h2 id="the-forward-euler-scheme-with-operator-notation">The Forward Euler scheme with operator notation </h2>

$$
\begin{equation}
[D_t^+ u  = -au]^n
\label{_auto4}
\end{equation}
$$


<!-- !split --><br><br><br><br><br><br><br><br>
<h2 id="the-crank-nicolson-scheme-with-operator-notation">The Crank-Nicolson scheme with operator notation </h2>

<p>Introduce an averaging operator:</p>

$$
\begin{equation}
[\overline{u}^{t}]^n = \half (u^{n-\half} + u^{n+\half} )
\approx u(t_n) \label{fd:mean:a}
\end{equation}
$$

<p>The Crank-Nicolson scheme can then be written as</p>

$$
\begin{equation}
[D_t u = -a\overline{u}^t]^{n+\half}
\label{fd:compact:ex:CN}
\end{equation}
$$

<p>Test: use the definitions and write out the above formula to see that
it really is the Crank-Nicolson scheme!
</p>

<!-- !split --><br><br><br><br><br><br><br><br>
<h1 id="decay:impl1">Implementation</h1>

<p>Model:</p>
$$
u'(t) = -au(t),\quad t\in (0,T], \quad u(0)=I
$$

<p>Numerical method:</p>

$$
u^{n+1} = \frac{1 - (1-\theta) a\Delta t}{1 + \theta a\Delta t}u^n
$$

<p>for \( \theta\in [0,1] \). Note</p>

<ul>
 <p><li> \( \theta=0 \) gives Forward Euler</li>
 <p><li> \( \theta=1 \) gives Backward Euler</li>
 <p><li> \( \theta=1/2 \) gives Crank-Nicolson</li>
</ul>
<!-- !split --><br><br><br><br><br><br><br><br>
<h2 id="requirements-of-a-program">Requirements of a program </h2>

<ul>
  <p><li> Compute the numerical solution \( u^n \), \( n=1,2,\ldots,N_t \)</li>
  <p><li> Display the numerical and exact solution \( \uex(t)=e^{-at} \)</li>
  <p><li> Bring evidence to a correct implementation (<em>verification</em>)</li>
  <p><li> Compare the numerical and the exact solution in a plot</li>
  <p><li> Compute the error \( \uex (t_n) - u^n \)</li>
</ul>
<!-- !split --><br><br><br><br><br><br><br><br>
<h2 id="tools-to-learn">Tools to learn </h2>

<ul>
  <p><li> Basic <a href="http://python.org" target="_self">Python</a> programming</li>
  <p><li> Array computing with <a href="http://numpy.org/" target="_self"><tt>numpy</tt></a></li>
  <p><li> Plotting with <a href="https://matplotlib.org" target="_self"><tt>matplotlib.pyplot</tt></a></li>
  <p><li> File writing and reading</li>
</ul>
<!-- !split --><br><br><br><br><br><br><br><br>
<h2 id="why-implement-in-python">Why implement in Python? </h2>

<ul>
  <p><li> Python has a very clean, readable syntax (often known as "executable pseudo-code").</li>
  <p><li> Python code is very similar to MATLAB code (and MATLAB has a particularly widespread use for scientific computing).</li>
  <p><li> Python is a full-fledged, very powerful programming language.</li>
  <p><li> Python is similar to, but much simpler to work with and results in more reliable code than C++.</li>
</ul>
<!-- !split --><br><br><br><br><br><br><br><br>
<h2 id="why-implement-in-python">Why implement in Python? </h2>

<ul>
  <p><li> Python has a rich set of modules for scientific computing, and its popularity in scientific computing is rapidly growing.</li>
  <p><li> Python was made for being combined with compiled languages (C, C++, Fortran) to reuse existing numerical software and to reach high computational performance of new implementations.</li>
  <p><li> Python has extensive support for administrative task needed when doing large-scale computational investigations.</li>
  <p><li> Python has extensive support for graphics (visualization, user interfaces, web applications).</li>
  <p><li> FEniCS, a very powerful tool for solving PDEs by the finite element method, is most human-efficient to operate from Python.</li>
</ul>
<!-- !split --><br><br><br><br><br><br><br><br>
<h2 id="decay:py1">Algorithm</h2>

<ul>
 <p><li> Store \( u^n \), \( n=0,1,\ldots,N_t \) in an array <code>u</code>.</li>
 <p><li> Algorithm:
<ol type="a"></li>
  <p><li> initialize \( u^0 \)</li>
  <p><li> for \( t=t_n \), \( n=1,2,\ldots,N_t \): compute \( u_n \) using the \( \theta \)-rule formula</li>
</ol>
</ul>
<!-- !split --><br><br><br><br><br><br><br><br>
<h2 id="translation-to-python-function">Translation to Python function </h2>


<!-- code=python (!bc pycod) typeset with pygments style "perldoc" -->
<div class="cell border-box-sizing code_cell rendered">
  <div class="input">
    <div class="inner_cell">
      <div class="input_area">
        <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 1</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 2</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 3</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 4</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 5</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 6</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 7</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 8</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 9</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">10</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">11</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">12</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">13</span></pre>
</div></td><td class="code"><div class="highlight" style="background: #eeeedd">
  <pre style="line-height: 125%;"><span style="color: #8B008B; font-weight: bold">from</span> <span style="color: #008b45; text-decoration: underline">numpy</span> <span style="color: #8B008B; font-weight: bold">import</span> *

<span style="color: #8B008B; font-weight: bold">def</span> <span style="color: #008b45">solver</span>(I, a, T, dt, theta):
    <span style="color: #CD5555">&quot;&quot;&quot;Solve u&#39;=-a*u, u(0)=I, for t in (0,T] with steps of dt.&quot;&quot;&quot;</span>
    Nt = <span style="color: #658b00">int</span>(T/dt)            <span style="color: #228B22"># no of time intervals</span>
    T = Nt*dt                 <span style="color: #228B22"># adjust T to fit time step dt</span>
    u = zeros(Nt+<span style="color: #B452CD">1</span>)           <span style="color: #228B22"># array of u[n] values</span>
    t = linspace(<span style="color: #B452CD">0</span>, T, Nt+<span style="color: #B452CD">1</span>)  <span style="color: #228B22"># time mesh</span>

    u[<span style="color: #B452CD">0</span>] = I                  <span style="color: #228B22"># assign initial condition</span>
    <span style="color: #8B008B; font-weight: bold">for</span> n <span style="color: #8B008B">in</span> <span style="color: #658b00">range</span>(<span style="color: #B452CD">0</span>, Nt):    <span style="color: #228B22"># n=0,1,...,Nt-1</span>
        u[n+<span style="color: #B452CD">1</span>] = (<span style="color: #B452CD">1</span> - (<span style="color: #B452CD">1</span>-theta)*a*dt)/(<span style="color: #B452CD">1</span> + theta*dt*a)*u[n]
    <span style="color: #8B008B; font-weight: bold">return</span> u, t
</pre>
</div>
</td></tr></table>      </div>
    </div>
  </div>
  <div class="output_wrapper">
    <div class="output">
      <div class="output_area">
        <div class="output_subarea output_stream output_stdout output_text">          
        </div>
      </div>
    </div>
  </div>
</div>

<p>Note about the <code>for</code> loop: <code>range(0, Nt, s)</code> generates all integers
from <code>0</code> to <code>Nt</code> in steps of <code>s</code> (default 1), <em>but not including</em> <code>Nt</code> (!).
</p>

<p>Sample call:</p>

<!-- code=python (!bc pycod) typeset with pygments style "perldoc" -->
<div class="cell border-box-sizing code_cell rendered">
  <div class="input">
    <div class="inner_cell">
      <div class="input_area">
        <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">1</span></pre>
</div></td><td class="code"><div class="highlight" style="background: #eeeedd">
  <pre style="line-height: 125%;">u, t = solver(I=<span style="color: #B452CD">1</span>, a=<span style="color: #B452CD">2</span>, T=<span style="color: #B452CD">8</span>, dt=<span style="color: #B452CD">0.8</span>, theta=<span style="color: #B452CD">1</span>)
</pre>
</div>
</td></tr></table>      </div>
    </div>
  </div>
  <div class="output_wrapper">
    <div class="output">
      <div class="output_area">
        <div class="output_subarea output_stream output_stdout output_text">          
        </div>
      </div>
    </div>
  </div>
</div>


<!-- !split --><br><br><br><br><br><br><br><br>
<h2 id="integer-division">Integer division </h2>

<p>Python applies integer division: <code>1/2</code> is 0, while <code>1./2</code> or <code>1.0/2</code> or
<code>1/2.</code> or <code>1/2.0</code> or <code>1.0/2.0</code> all give 0.5.
</p>

<p>A safer <code>solver</code> function (<code>dt = float(dt)</code> - guarantee float):</p>


<!-- code=python (!bc pycod) typeset with pygments style "perldoc" -->
<div class="cell border-box-sizing code_cell rendered">
  <div class="input">
    <div class="inner_cell">
      <div class="input_area">
        <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 1</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 2</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 3</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 4</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 5</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 6</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 7</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 8</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 9</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">10</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">11</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">12</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">13</span></pre>
</div></td><td class="code"><div class="highlight" style="background: #eeeedd">
  <pre style="line-height: 125%;"><span style="color: #8B008B; font-weight: bold">from</span> <span style="color: #008b45; text-decoration: underline">numpy</span> <span style="color: #8B008B; font-weight: bold">import</span> *

<span style="color: #8B008B; font-weight: bold">def</span> <span style="color: #008b45">solver</span>(I, a, T, dt, theta):
    <span style="color: #CD5555">&quot;&quot;&quot;Solve u&#39;=-a*u, u(0)=I, for t in (0,T] with steps of dt.&quot;&quot;&quot;</span>
    dt = <span style="color: #658b00">float</span>(dt)            <span style="color: #228B22"># avoid integer division</span>
    Nt = <span style="color: #658b00">int</span>(<span style="color: #658b00">round</span>(T/dt))     <span style="color: #228B22"># no of time intervals</span>
    T = Nt*dt                 <span style="color: #228B22"># adjust T to fit time step dt</span>
    u = zeros(Nt+<span style="color: #B452CD">1</span>)           <span style="color: #228B22"># array of u[n] values</span>
    t = linspace(<span style="color: #B452CD">0</span>, T, Nt+<span style="color: #B452CD">1</span>)  <span style="color: #228B22"># time mesh</span>
    u[<span style="color: #B452CD">0</span>] = I                  <span style="color: #228B22"># assign initial condition</span>
    <span style="color: #8B008B; font-weight: bold">for</span> n <span style="color: #8B008B">in</span> <span style="color: #658b00">range</span>(<span style="color: #B452CD">0</span>, Nt):    <span style="color: #228B22"># n=0,1,...,Nt-1</span>
        u[n+<span style="color: #B452CD">1</span>] = (<span style="color: #B452CD">1</span> - (<span style="color: #B452CD">1</span>-theta)*a*dt)/(<span style="color: #B452CD">1</span> + theta*dt*a)*u[n]
    <span style="color: #8B008B; font-weight: bold">return</span> u, t
</pre>
</div>
</td></tr></table>      </div>
    </div>
  </div>
  <div class="output_wrapper">
    <div class="output">
      <div class="output_area">
        <div class="output_subarea output_stream output_stdout output_text">          
        </div>
      </div>
    </div>
  </div>
</div>


<!-- !split --><br><br><br><br><br><br><br><br>
<h2 id="doc-strings">Doc strings </h2>

<ul>
 <p><li> First string after the function heading</li>
 <p><li> Used for documenting the function</li>
 <p><li> Automatic documentation tools can make fancy manuals for you</li>
 <p><li> Can be used for automatic testing</li>
</ul>

<!-- code=python (!bc pycod) typeset with pygments style "perldoc" -->
<div class="cell border-box-sizing code_cell rendered">
  <div class="input">
    <div class="inner_cell">
      <div class="input_area">
        <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 1</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 2</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 3</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 4</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 5</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 6</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 7</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 8</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 9</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">10</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">11</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">12</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">13</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">14</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">15</span></pre>
</div></td><td class="code"><div class="highlight" style="background: #eeeedd">
  <pre style="line-height: 125%;"><span style="color: #8B008B; font-weight: bold">def</span> <span style="color: #008b45">solver</span>(I, a, T, dt, theta):
    <span style="color: #CD5555">&quot;&quot;&quot;</span>
<span style="color: #CD5555">    Solve</span>

<span style="color: #CD5555">        u&#39;(t) = -a*u(t),</span>

<span style="color: #CD5555">    with initial condition u(0)=I, for t in the time interval</span>
<span style="color: #CD5555">    (0,T]. The time interval is divided into time steps of</span>
<span style="color: #CD5555">    length dt.</span>

<span style="color: #CD5555">    theta=1 corresponds to the Backward Euler scheme, theta=0</span>
<span style="color: #CD5555">    to the Forward Euler scheme, and theta=0.5 to the Crank-</span>
<span style="color: #CD5555">    Nicolson method.</span>
<span style="color: #CD5555">    &quot;&quot;&quot;</span>
    ...
</pre>
</div>
</td></tr></table>      </div>
    </div>
  </div>
  <div class="output_wrapper">
    <div class="output">
      <div class="output_area">
        <div class="output_subarea output_stream output_stdout output_text">          
        </div>
      </div>
    </div>
  </div>
</div>


<!-- !split --><br><br><br><br><br><br><br><br>
<h2 id="formatting-of-numbers">Formatting of numbers </h2>

<p>Can control formatting of reals and integers through the <em>printf</em> format:</p>


<!-- code=python (!bc pycod) typeset with pygments style "perldoc" -->
<div class="cell border-box-sizing code_cell rendered">
  <div class="input">
    <div class="inner_cell">
      <div class="input_area">
        <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">1</span></pre>
</div></td><td class="code"><div class="highlight" style="background: #eeeedd">
  <pre style="line-height: 125%;"><span style="color: #658b00">print</span>(<span style="color: #CD5555">&#39;t=%6.3f u=%g&#39;</span> % (t[i], u[i]))
</pre>
</div>
</td></tr></table>      </div>
    </div>
  </div>
  <div class="output_wrapper">
    <div class="output">
      <div class="output_area">
        <div class="output_subarea output_stream output_stdout output_text">          
        </div>
      </div>
    </div>
  </div>
</div>

<p>Or the alternative <em>format string syntax</em>:</p>

<!-- code=python (!bc pycod) typeset with pygments style "perldoc" -->
<div class="cell border-box-sizing code_cell rendered">
  <div class="input">
    <div class="inner_cell">
      <div class="input_area">
        <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">1</span></pre>
</div></td><td class="code"><div class="highlight" style="background: #eeeedd">
  <pre style="line-height: 125%;"><span style="color: #658b00">print</span>(<span style="color: #CD5555">&#39;t={t:6.3f} u={u:g}&#39;</span>.format(t=t[i], u=u[i]))
</pre>
</div>
</td></tr></table>      </div>
    </div>
  </div>
  <div class="output_wrapper">
    <div class="output">
      <div class="output_area">
        <div class="output_subarea output_stream output_stdout output_text">          
        </div>
      </div>
    </div>
  </div>
</div>

<p>Or even better through the alternative <em>f-string syntax</em>:</p>

<!-- code=python (!bc pycod) typeset with pygments style "perldoc" -->
<div class="cell border-box-sizing code_cell rendered">
  <div class="input">
    <div class="inner_cell">
      <div class="input_area">
        <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">1</span></pre>
</div></td><td class="code"><div class="highlight" style="background: #eeeedd">
  <pre style="line-height: 125%;"><span style="color: #658b00">print</span>(<span style="color: #CD5555">f&#39;t={</span>t[i]<span style="color: #CD5555">:6.3f} u={</span>u[i]<span style="color: #CD5555">:g}&#39;</span>)
</pre>
</div>
</td></tr></table>      </div>
    </div>
  </div>
  <div class="output_wrapper">
    <div class="output">
      <div class="output_area">
        <div class="output_subarea output_stream output_stdout output_text">          
        </div>
      </div>
    </div>
  </div>
</div>


<!-- !split --><br><br><br><br><br><br><br><br>
<h2 id="running-the-program">Running the program </h2>

<p>How to run the program <a href="http://tinyurl.com/ofkw6kc/alg/decay_v1.py" target="_self"><tt>decay_v1.py</tt></a>.</p>


<!-- code=text (!bc sys) typeset with pygments style "perldoc" -->
<div class="cell border-box-sizing code_cell rendered">
  <div class="input">
    <div class="inner_cell">
      <div class="input_area">
        <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">1</span></pre>
</div></td><td class="code"><div class="highlight" style="background: #eeeedd">
  <pre style="line-height: 125%;">Terminal&gt; python decay_v1.py
</pre>
</div>
</td></tr></table>      </div>
    </div>
  </div>
  <div class="output_wrapper">
    <div class="output">
      <div class="output_area">
        <div class="output_subarea output_stream output_stdout output_text">          
        </div>
      </div>
    </div>
  </div>
</div>

<p>Can also run it as "normal" Unix programs: <code>./decay_v1.py</code> if the
first line is
</p>


<!-- code=python (!bc pycod) typeset with pygments style "perldoc" -->
<div class="cell border-box-sizing code_cell rendered">
  <div class="input">
    <div class="inner_cell">
      <div class="input_area">
        <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">1</span></pre>
</div></td><td class="code"><div class="highlight" style="background: #eeeedd">
  <pre style="line-height: 125%;"><span style="color: #a61717; background-color: #e3d2d2">`</span><span style="color: #228B22">#!/usr/bin/env python`</span>
</pre>
</div>
</td></tr></table>      </div>
    </div>
  </div>
  <div class="output_wrapper">
    <div class="output">
      <div class="output_area">
        <div class="output_subarea output_stream output_stdout output_text">          
        </div>
      </div>
    </div>
  </div>
</div>

<p>Then</p>

<!-- code=text (!bc sys) typeset with pygments style "perldoc" -->
<div class="cell border-box-sizing code_cell rendered">
  <div class="input">
    <div class="inner_cell">
      <div class="input_area">
        <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">1</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">2</span></pre>
</div></td><td class="code"><div class="highlight" style="background: #eeeedd">
  <pre style="line-height: 125%;">Terminal&gt; chmod a+rx decay_v1.py
Terminal&gt; ./decay_v1.py
</pre>
</div>
</td></tr></table>      </div>
    </div>
  </div>
  <div class="output_wrapper">
    <div class="output">
      <div class="output_area">
        <div class="output_subarea output_stream output_stdout output_text">          
        </div>
      </div>
    </div>
  </div>
</div>


<!-- !split --><br><br><br><br><br><br><br><br>
<h2 id="plotting-the-solution">Plotting the solution </h2>

<p>Basic syntax:</p>


<!-- code=python (!bc pycod) typeset with pygments style "perldoc" -->
<div class="cell border-box-sizing code_cell rendered">
  <div class="input">
    <div class="inner_cell">
      <div class="input_area">
        <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">1</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">2</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">3</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">4</span></pre>
</div></td><td class="code"><div class="highlight" style="background: #eeeedd">
  <pre style="line-height: 125%;"><span style="color: #8B008B; font-weight: bold">from</span> <span style="color: #008b45; text-decoration: underline">matplotlib.pyplot</span> <span style="color: #8B008B; font-weight: bold">import</span> *

plot(t, u)
show()
</pre>
</div>
</td></tr></table>      </div>
    </div>
  </div>
  <div class="output_wrapper">
    <div class="output">
      <div class="output_area">
        <div class="output_subarea output_stream output_stdout output_text">          
        </div>
      </div>
    </div>
  </div>
</div>

<p>Can (and should!) add labels on axes, title, legends.</p>

<!-- !split --><br><br><br><br><br><br><br><br>
<h2 id="comparing-with-the-exact-solution">Comparing with the exact solution </h2>

<p>Python function for the exact solution \( \uex(t)=Ie^{-at} \):</p>


<!-- code=python (!bc pycod) typeset with pygments style "perldoc" -->
<div class="cell border-box-sizing code_cell rendered">
  <div class="input">
    <div class="inner_cell">
      <div class="input_area">
        <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">1</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">2</span></pre>
</div></td><td class="code"><div class="highlight" style="background: #eeeedd">
  <pre style="line-height: 125%;"><span style="color: #8B008B; font-weight: bold">def</span> <span style="color: #008b45">u_exact</span>(t, I, a):
    <span style="color: #8B008B; font-weight: bold">return</span> I*exp(-a*t)
</pre>
</div>
</td></tr></table>      </div>
    </div>
  </div>
  <div class="output_wrapper">
    <div class="output">
      <div class="output_area">
        <div class="output_subarea output_stream output_stdout output_text">          
        </div>
      </div>
    </div>
  </div>
</div>

<p>Quick plotting:</p>


<!-- code=python (!bc pycod) typeset with pygments style "perldoc" -->
<div class="cell border-box-sizing code_cell rendered">
  <div class="input">
    <div class="inner_cell">
      <div class="input_area">
        <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">1</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">2</span></pre>
</div></td><td class="code"><div class="highlight" style="background: #eeeedd">
  <pre style="line-height: 125%;">u_e = u_exact(t, I, a)
plot(t, u, t, u_e)
</pre>
</div>
</td></tr></table>      </div>
    </div>
  </div>
  <div class="output_wrapper">
    <div class="output">
      <div class="output_area">
        <div class="output_subarea output_stream output_stdout output_text">          
        </div>
      </div>
    </div>
  </div>
</div>

<p>Problem: \( \uex(t) \) applies the same mesh as \( u^n \) and
looks as a piecewise linear function.
</p>

<p>Remedy: Introduce a very fine mesh for \( \uex \).</p>


<!-- code=python (!bc pycod) typeset with pygments style "perldoc" -->
<div class="cell border-box-sizing code_cell rendered">
  <div class="input">
    <div class="inner_cell">
      <div class="input_area">
        <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">1</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">2</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">3</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">4</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">5</span></pre>
</div></td><td class="code"><div class="highlight" style="background: #eeeedd">
  <pre style="line-height: 125%;">t_e = linspace(<span style="color: #B452CD">0</span>, T, <span style="color: #B452CD">1001</span>)      <span style="color: #228B22"># fine mesh</span>
u_e = u_exact(t_e, I, a)

plot(t_e, u_e, <span style="color: #CD5555">&#39;b-&#39;</span>,            <span style="color: #228B22"># blue line for u_e</span>
     t,   u,   <span style="color: #CD5555">&#39;r--o&#39;</span>)          <span style="color: #228B22"># red dashes w/circles</span>
</pre>
</div>
</td></tr></table>      </div>
    </div>
  </div>
  <div class="output_wrapper">
    <div class="output">
      <div class="output_area">
        <div class="output_subarea output_stream output_stdout output_text">          
        </div>
      </div>
    </div>
  </div>
</div>


<!-- !split --><br><br><br><br><br><br><br><br>
<h2 id="add-legends-axes-labels-title-and-wrap-in-a-function">Add legends, axes labels, title, and wrap in a function </h2>


<!-- code=python (!bc pycod) typeset with pygments style "perldoc" -->
<div class="cell border-box-sizing code_cell rendered">
  <div class="input">
    <div class="inner_cell">
      <div class="input_area">
        <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 1</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 2</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 3</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 4</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 5</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 6</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 7</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 8</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 9</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">10</span></pre>
</div></td><td class="code"><div class="highlight" style="background: #eeeedd">
  <pre style="line-height: 125%;"><span style="color: #8B008B; font-weight: bold">def</span> <span style="color: #008b45">plot_numerical_and_exact</span>(theta, I, a, T, dt):
    <span style="color: #CD5555">&quot;&quot;&quot;Compare the numerical and exact solution in a plot.&quot;&quot;&quot;</span>
    u, t = solver(I=I, a=a, T=T, dt=dt, theta=theta)
    t_e = linspace(<span style="color: #B452CD">0</span>, T, <span style="color: #B452CD">1001</span>)        <span style="color: #228B22"># fine mesh for u_e</span>
    u_e = u_exact(t_e, I, a)
    plot(t, u, <span style="color: #CD5555">&#39;r--o&#39;</span>, t_e, u_e, <span style="color: #CD5555">&#39;b-&#39;</span>)
    legend([<span style="color: #CD5555">&#39;numerical&#39;</span>, <span style="color: #CD5555">&#39;exact&#39;</span>])
    xlabel(<span style="color: #CD5555">&#39;t&#39;</span>); ylabel(<span style="color: #CD5555">&#39;u&#39;</span>)
    title(<span style="color: #CD5555">&#39;theta=%g, dt=%g&#39;</span> % (theta, dt))
    savefig(<span style="color: #CD5555">&#39;plot_%s_%g.png&#39;</span> % (theta, dt))
</pre>
</div>
</td></tr></table>      </div>
    </div>
  </div>
  <div class="output_wrapper">
    <div class="output">
      <div class="output_area">
        <div class="output_subarea output_stream output_stdout output_text">          
        </div>
      </div>
    </div>
  </div>
</div>


<center>  <!-- FIGURE -->
<hr class="figure">
<center>
<p class="caption">Figure 9</p>
</center>
<p><img src="fig-alg/decay_v2.png" width="400" align="bottom"></p>
</center>

<!-- !split --><br><br><br><br><br><br><br><br>
<h1 id="decay:verification">Verifying the implementation</h1>

<ul>
 <p><li> Verification = bring evidence that the program works</li>
 <p><li> Find suitable test problems</li>
 <p><li> Make function for each test problem</li>
 <p><li> Later: put the verification tests in a professional testing framework</li>
</ul>
<!-- !split --><br><br><br><br><br><br><br><br>
<h2 id="simplest-method-run-a-few-algorithmic-steps-by-hand">Simplest method: run a few algorithmic steps by hand </h2>

<p>Use a calculator (\( I=0.1 \), \( \theta=0.8 \), \( \Delta t =0.8 \)):</p>

$$ A\equiv \frac{1 - (1-\theta) a\Delta t}{1 + \theta a \Delta t} = 0.298245614035$$


$$
\begin{align*}
u^1 &= AI=0.0298245614035,\\ 
u^2 &= Au^1= 0.00889504462912,\\ 
u^3 &=Au^2= 0.00265290804728
\end{align*}
$$

<p>See the function <code>test_solver_three_steps</code> in <a href="https://github.com/hplgit/decay-book/blob/master/src/alg/decay_v3.py" target="_self"><tt>decay_v3.py</tt></a>.</p>

<!-- !split --><br><br><br><br><br><br><br><br>
<h2 id="comparison-with-an-exact-discrete-solution">Comparison with an exact discrete solution </h2>

<div class="alert alert-block alert-notice alert-text-normal">
<b>Best verification</b>
<p>
<p>Compare computed numerical solution
with a closed-form <em>exact discrete solution</em> (if possible).
</p>
</div>


<p>Define</p>
$$ A = \frac{1 - (1-\theta) a\Delta t}{1 + \theta a \Delta t}$$

<p>Repeated use of the \( \theta \)-rule:</p>
$$
\begin{align*}
u^0 &= I,\\ 
u^1 &= Au^0 = AI\\ 
u^n &= A^nu^{n-1} = A^nI
\end{align*}
$$


<!-- !split --><br><br><br><br><br><br><br><br>
<h2 id="making-a-test-based-on-an-exact-discrete-solution">Making a test based on an exact discrete solution </h2>

<p>The exact discrete solution is</p>

$$
\begin{equation}
u^n = IA^n
\label{decay:un:exact}
\end{equation}
$$


<div class="alert alert-block alert-question alert-text-normal">
<b>Question</b>
<p>
<p>Understand what \( n \) in \( u^n \) and in \( A^n \) means!</p>
</div>


<p>Test if</p>

$$ \max_n |u^n - \uex(t_n)| < \epsilon\sim 10^{-15}$$

<p>Implementation in <a href="http://tinyurl.com/ofkw6kc/alg/decay_verf2.py" target="_self"><tt>decay_verf2.py</tt></a>.</p>

<!-- !split --><br><br><br><br><br><br><br><br>
<h2 id="decay:computing:error">Computing the numerical error as a mesh function</h2>

<p>Task: compute the numerical error \( e^n = \uex(t_n) - u^n \)</p>

<p>Exact solution: \( \uex(t)=Ie^{-at} \), implemented as</p>


<!-- code=python (!bc pycod) typeset with pygments style "perldoc" -->
<div class="cell border-box-sizing code_cell rendered">
  <div class="input">
    <div class="inner_cell">
      <div class="input_area">
        <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">1</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">2</span></pre>
</div></td><td class="code"><div class="highlight" style="background: #eeeedd">
  <pre style="line-height: 125%;"><span style="color: #8B008B; font-weight: bold">def</span> <span style="color: #008b45">u_exact</span>(t, I, a):
    <span style="color: #8B008B; font-weight: bold">return</span> I*exp(-a*t)
</pre>
</div>
</td></tr></table>      </div>
    </div>
  </div>
  <div class="output_wrapper">
    <div class="output">
      <div class="output_area">
        <div class="output_subarea output_stream output_stdout output_text">          
        </div>
      </div>
    </div>
  </div>
</div>

<p>Compute \( e^n \) by</p>


<!-- code=python (!bc pycod) typeset with pygments style "perldoc" -->
<div class="cell border-box-sizing code_cell rendered">
  <div class="input">
    <div class="inner_cell">
      <div class="input_area">
        <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">1</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">2</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">3</span></pre>
</div></td><td class="code"><div class="highlight" style="background: #eeeedd">
  <pre style="line-height: 125%;">u, t = solver(I, a, T, dt, theta)  <span style="color: #228B22"># Numerical solution</span>
u_e = u_exact(t, I, a)
e = u_e - u
</pre>
</div>
</td></tr></table>      </div>
    </div>
  </div>
  <div class="output_wrapper">
    <div class="output">
      <div class="output_area">
        <div class="output_subarea output_stream output_stdout output_text">          
        </div>
      </div>
    </div>
  </div>
</div>


<div class="alert alert-block alert-notice alert-text-normal">
<b>Array arithmetics - we compute on entire arrays!</b>
<p>

<ul>
 <p><li> <code>u_exact(t, I, a)</code> works with <code>t</code> as array</li>
 <p><li> Must have <code>exp</code> from <code>numpy</code> (not <code>math</code>)</li>
 <p><li> <code>e = u_e - u</code>: array subtraction</li>
 <p><li> Array arithmetics gives shorter and much faster code</li>
</ul>
</div>


<!-- !split --><br><br><br><br><br><br><br><br>
<h2 id="decay:computing:error:norm">Computing the norm of the error</h2>

<ul>
 <p><li> \( e^n \) is a mesh function</li>
 <p><li> Usually we want one number for the error</li>
 <p><li> Use a norm of \( e^n \)</li>
</ul>
<p>Norms of a function \( f(t) \):</p>

$$
\begin{align}
||f||_{L^2} &= \left( \int_0^T f(t)^2 dt\right)^{1/2}
\label{decay:norms:L2}\\ 
||f||_{L^1} &= \int_0^T |f(t)| dt
\label{decay:norms:L1}\\ 
||f||_{L^\infty} &= \max_{t\in [0,T]}|f(t)|
\label{decay:norms:Linf}
\end{align}
$$


<!-- !split --><br><br><br><br><br><br><br><br>
<h2 id="norms-of-mesh-functions">Norms of mesh functions </h2>

<ul>
 <p><li> Problem: \( f^n =f(t_n) \) is a mesh function and hence not defined for all \( t \). How to integrate \( f^n \)?</li>
 <p><li> Idea: Apply a numerical integration rule, using only the mesh points of the mesh function.</li>
</ul>
<p>The Trapezoidal rule:</p>

$$ ||f^n|| = \left(\Delta t\left(\half(f^0)^2 + \half(f^{N_t})^2
+ \sum_{n=1}^{N_t-1} (f^n)^2\right)\right)^{1/2} $$

<p>Common simplification yields the \( L^2 \) norm of a mesh function:</p>

$$ ||f^n||_{\ell^2} = \left(\Delta t\sum_{n=0}^{N_t} (f^n)^2\right)^{1/2}$$


<!-- !split --><br><br><br><br><br><br><br><br>
<h2 id="norms-notice">Norms - notice! </h2>
<div class="alert alert-block alert-notice alert-text-normal">
<b>Notice</b>
<p>
<ul>
 <p><li> The <em>continuous</em> norms use capital \( L^2, L^1, L^\infty{} \)</li>
 <p><li> The <em>discrete</em> norm uses lowercase \( \ell^2 \)</li>
</ul>
</div>


<!-- !split --><br><br><br><br><br><br><br><br>
<h2 id="implementation-of-the-norm-of-the-error">Implementation of the norm of the error </h2>

$$ E = ||e^n||_{\ell^2}  = \sqrt{\Delta t\sum_{n=0}^{N_t} (e^n)^2}$$

<p>Python w/array arithmetics:</p>


<!-- code=python (!bc pycod) typeset with pygments style "perldoc" -->
<div class="cell border-box-sizing code_cell rendered">
  <div class="input">
    <div class="inner_cell">
      <div class="input_area">
        <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">1</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">2</span></pre>
</div></td><td class="code"><div class="highlight" style="background: #eeeedd">
  <pre style="line-height: 125%;">e = u_exact(t) - u
E = sqrt(dt*<span style="color: #658b00">sum</span>(e**<span style="color: #B452CD">2</span>))
</pre>
</div>
</td></tr></table>      </div>
    </div>
  </div>
  <div class="output_wrapper">
    <div class="output">
      <div class="output_area">
        <div class="output_subarea output_stream output_stdout output_text">          
        </div>
      </div>
    </div>
  </div>
</div>


<!-- !split --><br><br><br><br><br><br><br><br>
<h2 id="comment-on-array-vs-scalar-computation">Comment on array vs scalar computation </h2>

<p>Scalar computing of <code>E = sqrt(dt*sum(e**2))</code>:</p>


<!-- code=python (!bc pycod) typeset with pygments style "perldoc" -->
<div class="cell border-box-sizing code_cell rendered">
  <div class="input">
    <div class="inner_cell">
      <div class="input_area">
        <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 1</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 2</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 3</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 4</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 5</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 6</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 7</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 8</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 9</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">10</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">11</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">12</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">13</span></pre>
</div></td><td class="code"><div class="highlight" style="background: #eeeedd">
  <pre style="line-height: 125%;">m = <span style="color: #658b00">len</span>(u)     <span style="color: #228B22"># length of u array (alt: u.size)</span>
u_e = zeros(m)
t = <span style="color: #B452CD">0</span>
<span style="color: #8B008B; font-weight: bold">for</span> i <span style="color: #8B008B">in</span> <span style="color: #658b00">range</span>(m):
    u_e[i] = u_exact(t, a, I)
    t = t + dt
e = zeros(m)
<span style="color: #8B008B; font-weight: bold">for</span> i <span style="color: #8B008B">in</span> <span style="color: #658b00">range</span>(m):
    e[i] = u_e[i] - u[i]
s = <span style="color: #B452CD">0</span>  <span style="color: #228B22"># summation variable</span>
<span style="color: #8B008B; font-weight: bold">for</span> i <span style="color: #8B008B">in</span> <span style="color: #658b00">range</span>(m):
    s = s + e[i]**<span style="color: #B452CD">2</span>
error = sqrt(dt*s)
</pre>
</div>
</td></tr></table>      </div>
    </div>
  </div>
  <div class="output_wrapper">
    <div class="output">
      <div class="output_area">
        <div class="output_subarea output_stream output_stdout output_text">          
        </div>
      </div>
    </div>
  </div>
</div>


<div class="alert alert-block alert-notice alert-text-normal">
<b>Scalar computing</b>
<p>
<p>takes more code, is less readable and runs much slower</p>
</div>


<div class="alert alert-block alert-notice alert-text-normal">
<b>Rule</b>
<p>
<p>Compute on entire arrays (when possible)! Vectorization!</p>
</div>

<!-- ------------------- end of main content --------------- -->
</body>
</html>

